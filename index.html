<!DOCTYPE html>
<html lang="lt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Hexacola AI Image Generator with Camera Features and Colors</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <style>
    /* General Styles */
    body {
      margin: 0;
      font-family: "Courier Prime", monospace;
      background-color: #1e1e1e;
      color: #ffffff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      transition: background-color 0.3s, color 0.3s;
      overflow: auto; /* Enable overall page scrolling */
    }
    body.dark-mode {
      background-color: #121212;
      color: #e0e0e0;
    }
    .main-wrapper {
      display: flex;
      width: 100%;
      max-width: 1200px;
      padding: 20px;
      box-sizing: border-box;
      flex: 1;
      /* Removed overflow: hidden to allow scrolling */
      flex-direction: row;
      gap: 20px;
    }
    /* Sidebar */
    .sidebar {
      flex: 1;
      max-width: 300px;
      background-color: rgba(30, 30, 30, 0.95);
      border: 2px solid #444;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.7);
      transition: background-color 0.3s, border-color 0.3s;
      display: flex;
      flex-direction: column;
      height: fit-content;
      overflow-y: auto; /* Enable sidebar scrolling if content overflows */
    }
    body.dark-mode .sidebar {
      background-color: rgba(18, 18, 18, 0.95);
      border-color: #666;
    }
    .sidebar h2 {
      margin-top: 0;
      color: #00ffcc;
      text-shadow: 0 0 5px rgba(0, 255, 204, 0.5);
    }
    .sidebar .input-group {
      margin-bottom: 20px;
      text-align: left;
      position: relative;
    }
    .sidebar .input-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #00ffcc;
      text-shadow: 0 0 5px rgba(0, 255, 204, 0.5);
    }
    .sidebar .input-group button {
      width: 100%;
      padding: 10px;
      font-size: 1em;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s, transform 0.2s;
      color: #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
      margin-bottom: 10px;
    }
    .sidebar .input-group button.generate-prompt {
      background-color: #00ffcc;
    }
    .sidebar .input-group button.generate-prompt:hover {
      background-color: #00e6b3;
      transform: translateY(-2px);
    }
    /* Library Button */
    .sidebar .library-button {
      background-color: #007BFF;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .sidebar .library-button:hover {
      background-color: #0056b3;
    }
    /* Chat Area */
    .chat {
      flex: 1;
      display: flex;
      flex-direction: column;
      background-color: rgba(18, 18, 18, 0.95);
      border: 2px solid #666;
      border-radius: 15px;
      padding: 15px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.7);
      overflow-y: auto;
      margin-bottom: 20px;
      max-height: 300px; /* Adjust as needed */
    }
    .chat-message {
      margin-bottom: 15px;
      padding: 10px;
      border-radius: 8px;
      background-color: #333333;
      color: #ffffff;
      word-wrap: break-word;
      white-space: pre-wrap;
    }
    .chat-message.user {
      background-color: #00b3a4;
      align-self: flex-end;
    }
    .chat-message.assistant {
      background-color: #555555;
      align-self: flex-start;
    }
    .chat-input-group {
      display: flex;
      gap: 10px;
    }
    .chat-input-group input {
      flex: 1;
      padding: 10px;
      border: 2px solid #00ffcc;
      border-radius: 8px;
      background-color: #2c2c2c;
      color: #ffffff;
      transition: background-color 0.3s, border-color 0.3s;
      box-shadow: inset 0 0 10px rgba(0, 255, 204, 0.1);
    }
    body.dark-mode .chat-input-group input {
      background-color: #1e1e1e;
      border-color: #00b3a4;
      color: #e0e0e0;
    }
    .chat-input-group button {
      padding: 10px 15px;
      font-size: 1em;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s, transform 0.2s;
      color: #ffffff;
      background-color: #00ffcc;
      display: flex;
      align-items: center;
      gap: 5px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    }
    .chat-input-group button:hover {
      background-color: #00e6b3;
      transform: translateY(-2px);
    }
    /* Main Container */
    .container, .library-container {
      flex: 2;
      background-color: rgba(30, 30, 30, 0.95);
      border: 2px solid #444;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.7);
      transition: background-color 0.3s, border-color 0.3s;
      position: relative;
      display: none;
      flex-direction: column;
      height: fit-content;
      overflow-y: auto; /* Enable container scrolling if content overflows */
    }
    .container.active, .library-container.active {
      display: flex;
    }
    body.dark-mode .container,
    body.dark-mode .library-container {
      background-color: rgba(18, 18, 18, 0.95);
      border-color: #666;
    }
    .header {
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .header h1, .library-container h2 {
      font-size: 2em;
      margin: 0;
      color: #00ffcc;
      text-shadow: 0 0 10px rgba(0, 255, 204, 0.7);
      text-align: center;
    }
    .input-group {
      display: flex;
      flex-direction: column;
      margin-bottom: 20px;
      text-align: left;
      position: relative;
    }
    .input-group label {
      margin-bottom: 8px;
      font-weight: bold;
      color: #00ffcc;
      text-shadow: 0 0 5px rgba(0, 255, 204, 0.5);
    }
    .input-group textarea, .input-group select, .input-group input {
      padding: 10px;
      border: 2px solid #00ffcc;
      border-radius: 8px;
      resize: vertical;
      font-size: 1em;
      background-color: #2c2c2c;
      color: #ffffff;
      transition: background-color 0.3s, border-color 0.3s;
      box-shadow: inset 0 0 10px rgba(0, 255, 204, 0.1);
      width: 100%;
      box-sizing: border-box;
    }
    body.dark-mode .input-group textarea,
    body.dark-mode .input-group select,
    body.dark-mode .input-group input {
      background-color: #1e1e1e;
      border-color: #00b3a4;
      color: #e0e0e0;
    }
    /* Additional Character Description */
    .input-group button#addCharacterBtn {
      margin-top: 10px;
      padding: 5px 10px;
      font-size: 1.2em;
      background-color: #00ffcc;
      color: #000;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s;
      width: 40px;
      height: 40px;
      position: absolute;
      right: 0;
      top: 0;
    }
    .input-group button#addCharacterBtn:hover {
      background-color: #00e6b3;
    }
    .additional-character-group {
      margin-bottom: 15px;
      position: relative;
    }
    .additional-character-group button {
      margin-top: 10px;
      padding: 5px 10px;
      font-size: 1em;
      background-color: #ff4d4d;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s;
      position: absolute;
      right: 0;
      top: 0;
    }
    .additional-character-group button:hover {
      background-color: #e60000;
    }
    /* Options */
    .options {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      margin-bottom: 20px;
      text-align: left;
      gap: 10px;
    }
    .options .option {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      margin-bottom: 15px;
      width: 48%;
      box-sizing: border-box;
    }
    .options .option label {
      margin-bottom: 8px;
      font-weight: bold;
      color: #00ffcc;
      text-shadow: 0 0 5px rgba(0, 255, 204, 0.5);
    }
    .options .option input,
    .options .option select {
      padding: 8px;
      border: 2px solid #00ffcc;
      border-radius: 8px;
      font-size: 1em;
      background-color: #333333;
      color: #ffffff;
      transition: background-color 0.3s, border-color 0.3s;
      width: 100%;
      box-shadow: inset 0 0 10px rgba(0, 255, 204, 0.1);
      box-sizing: border-box;
    }
    body.dark-mode .options .option input,
    body.dark-mode .options .option select {
      background-color: #1e1e1e;
      border-color: #00b3a4;
      color: #e0e0e0;
    }
    /* Buttons */
    .buttons {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .buttons button {
      padding: 10px 20px;
      font-size: 1em;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s, transform 0.2s;
      color: #ffffff;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    }
    .buttons button.generate {
      background-color: #00ffcc;
    }
    .buttons button.generate:hover {
      background-color: #00e6b3;
      transform: translateY(-2px);
    }
    .buttons button.dark-mode-toggle {
      background-color: #555555;
    }
    .buttons button.dark-mode-toggle:hover {
      background-color: #777777;
      transform: translateY(-2px);
    }
    .buttons button.auto-toggle {
      background-color: #ffcc00;
      color: #000000;
      position: relative;
    }
    .buttons button.auto-toggle.active {
      background-color: #ffaa00;
    }
    .buttons button.auto-toggle:hover {
      background-color: #ffaa00;
      transform: translateY(-2px);
    }
    .buttons button.auto-toggle::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      background-color: #333;
      color: #fff;
      padding: 5px 10px;
      border-radius: 5px;
      white-space: nowrap;
      opacity: 0;
      transition: opacity 0.3s;
      pointer-events: none;
      font-size: 0.9em;
      z-index: 1;
    }
    .buttons button.auto-toggle:hover::after {
      opacity: 1;
    }
    .buttons button.clear-library {
      background-color: #ff4444;
    }
    .buttons button.clear-library:hover {
      background-color: #cc0000;
      transform: translateY(-2px);
    }
    /* Generated Images */
    .generated-image, .library-container .generated-image {
      margin-top: 20px;
      position: relative;
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
      overflow-y: auto;
      max-height: 400px; /* Adjust as needed */
    }
    .image-container {
      position: relative;
      width: 200px;
      flex-shrink: 0;
    }
    .image-container img {
      width: 100%;
      height: auto;
      border: 2px solid #00ffcc;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 0.3s, box-shadow 0.3s;
      display: block;
      filter: contrast(1.2) brightness(1.1) sepia(0.3) saturate(1.5) hue-rotate(-10deg);
      image-rendering: pixelated;
    }
    .image-container img:hover {
      transform: scale(1.05);
      box-shadow: 0 0 20px rgba(0, 255, 204, 0.7);
    }
    /* Caption */
    .caption {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      background: rgba(0, 0, 0, 0.6);
      color: #ffffff;
      padding: 10px;
      box-sizing: border-box;
      border-bottom-left-radius: 10px;
      border-bottom-right-radius: 10px;
      font-size: 0.8em;
      opacity: 0;
      transition: opacity 0.3s;
      max-height: 50%;
      overflow: auto;
      text-align: left;
    }
    .image-container:hover .caption {
      opacity: 1;
    }
    /* Download Options */
    .download-options {
      position: absolute;
      top: 10px;
      right: 10px;
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    .download-options select,
    .download-options button {
      padding: 5px;
      font-size: 0.8em;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      background-color: rgba(255, 255, 255, 0.8);
      color: #000;
      transition: background-color 0.3s;
    }
    .download-options button:hover {
      background-color: rgba(255, 255, 255, 1);
    }
    /* Loader and Overlay */
    .loader {
      border: 8px solid #f3f3f3;
      border-top: 8px solid #00ffcc;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      animation: spin 1s linear infinite;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 10;
    }
    .overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(30, 30, 30, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 15px;
      z-index: 9;
      display: none;
      flex-direction: column;
      gap: 15px;
    }
    .progress-container {
      width: 80%;
      background-color: #555;
      border-radius: 25px;
      overflow: hidden;
      margin-top: 15px;
    }
    .progress-bar {
      height: 20px;
      width: 0%;
      background-color: #00ffcc;
      transition: width 0.3s;
    }
    @keyframes spin {
      0% { transform: rotate(0deg) translate(-50%, -50%); }
      100% { transform: rotate(360deg) translate(-50%, -50%); }
    }
    /* Footer */
    footer {
      margin-top: 20px;
      font-size: 0.8em;
      color: #aaaaaa;
      text-align: center;
      width: 100%;
    }
    footer a {
      color: #00ffcc;
      text-decoration: none;
      font-weight: bold;
    }
    footer a:hover {
      text-decoration: underline;
    }
    /* Responsive */
    @media (max-width: 1200px) {
      .main-wrapper {
        flex-direction: column;
        align-items: center;
      }
      .sidebar {
        max-width: none;
        margin-right: 0;
        margin-bottom: 20px;
        width: 100%;
      }
      .container, .library-container {
        width: 100%;
      }
      .options .option {
        width: 100%;
      }
    }
    @media (max-width: 900px) {
      .chat {
        max-height: 200px;
      }
      .generated-image, .library-container .generated-image {
        max-height: 300px;
      }
    }
    @media (max-width: 600px) {
      .options .option {
        width: 100%;
      }
      .buttons {
        flex-direction: column;
        gap: 15px;
      }
      .loader {
        width: 40px;
        height: 40px;
        border-width: 6px;
      }
      .image-container {
        width: 100%;
      }
      .caption {
        font-size: 0.8em;
        padding: 8px;
      }
      .progress-container {
        width: 90%;
      }
      .download-options {
        flex-direction: column;
      }
    }
    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 100;
      padding-top: 60px;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.9);
    }
    .modal-content {
      margin: auto;
      display: block;
      width: 80%;
      max-width: 1000px;
      animation-name: zoom;
      animation-duration: 0.6s;
    }
    #caption {  
      animation-name: zoom;
      animation-duration: 0.6s;
    }
    @keyframes zoom {
      from {transform:scale(0)} 
      to {transform:scale(1)}
    }
    .close {
      position: absolute;
      top: 30px;
      right: 45px;
      color: #ffffff;
      font-size: 40px;
      font-weight: bold;
      transition: color 0.3s;
      cursor: pointer;
    }
    .close:hover,
    .close:focus {
      color: #00ffcc;
      text-decoration: none;
      cursor: pointer;
    }
    @media only screen and (max-width: 700px){
      .modal-content {
        width: 100%;
      }
      .close {
        top: 15px;
        right: 35px;
        font-size: 30px;
      }
    }
    /* Camera Features and Colors Styles */
    .description {
      margin-bottom: 20px;
      padding: 10px;
      border: 1px solid #ccc;
      width: 100%;
      background-color: #2c2c2c;
      border-radius: 8px;
      color: #ffffff;
      box-sizing: border-box;
    }
    .camera-color-section {
      margin-top: 20px;
    }
    .camera-color-section h2 {
      color: #00ffcc;
      text-shadow: 0 0 5px rgba(0, 255, 204, 0.5);
      margin-bottom: 10px;
      font-size: 1.5em;
    }
    .camera-color-section select {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border: 2px solid #00ffcc;
      border-radius: 8px;
      background-color: #2c2c2c;
      color: #ffffff;
      transition: background-color 0.3s, border-color 0.3s;
      box-shadow: inset 0 0 10px rgba(0, 255, 204, 0.1);
      box-sizing: border-box;
    }
    body.dark-mode .camera-color-section select {
      background-color: #1e1e1e;
      border-color: #00b3a4;
      color: #e0e0e0;
    }
  </style>
</head>
<body>
  <div class="main-wrapper">
    <!-- Sidebar for Chat and Prompt Generators -->
    <div class="sidebar">
      <h2>AI Prompt Generator</h2>
      <div class="input-group">
        <label>Generuoti Aprašymą:</label>
        <button class="generate-prompt" onclick="generateRandomPrompt('background')"><i class="fas fa-lightbulb"></i> GENERUOTI Į FONĄ</button>
        <button class="generate-prompt" onclick="generateRandomPrompt('character')"><i class="fas fa-lightbulb"></i> GENERUOTI Į PERSONAŽĄ</button>
      </div>
      <!-- Library Button -->
      <div class="input-group">
        <button class="library-button" onclick="showLibrary()"><i class="fas fa-images"></i> LIBRARY</button>
      </div>
      <!-- Chat Interface -->
      <h2>Hexacola Chat</h2>
      <div class="chat" id="chat">
        <!-- Chat messages will appear here -->
      </div>
      <div class="chat-input-group">
        <input type="text" id="chatInput" placeholder="Rašykite žinutę..." />
        <button onclick="sendMessage()"><i class="fas fa-paper-plane"></i> Siųsti</button>
      </div>
    </div>

    <!-- Main Container for Image Generation and Camera Features/Colors -->
    <div class="container active" id="generatorContainer">
      <div class="header">
        <h1>Hexacola AI Image Generator</h1>
      </div>
      <div class="input-group">
        <label for="backgroundPrompt">Background Description:</label>
        <textarea id="backgroundPrompt" placeholder="Pvz., Saulėlydis kalnuose, ramus ežeras..."></textarea>
      </div>
      <div class="input-group">
        <label for="characterPrompt">Character Description:</label>
        <textarea id="characterPrompt" placeholder="Pvz., Jaunas riteris su sidabru kruopelė..."></textarea>
        <button type="button" id="addCharacterBtn" onclick="addCharacterDescription()" title="Pridėti papildomą personažo aprašymą">+</button>
      </div>
      <div id="additionalCharacterDescriptions"></div>
      <div class="input-group">
        <label for="negativePrompt">Negative Prompt:</label>
        <textarea id="negativePrompt" placeholder="Nenoriu logotipo, iškraipyto stiliaus..."></textarea>
      </div>
      <div class="options">
        <div class="option">
          <label for="model">Modelis:</label>
          <select id="model">
            <option value="flux" selected>Flux</option>
            <option value="flux-anime">Flux-Anime</option>
            <option value="flux-3d">Flux-3D</option>
            <option value="flux-pro">Flux-Pro</option>
            <option value="flux-realism">Flux-Realism</option>
            <option value="flux-cablyal">Flux-CablyAl</option>
            <option value="any-dark">Any-Dark</option>
            <option value="turbo">Turbo</option>
            <option value="Unity">Unity</option>
          </select>
        </div>
        <div class="option">
          <label for="width">Plotis (px):</label>
          <input type="number" id="width" value="512" min="64" max="2048" />
        </div>
        <div class="option">
          <label for="height">Aukštis (px):</label>
          <input type="number" id="height" value="512" min="64" max="2048" />
        </div>
        <div class="option">
          <label for="seed">Seed:</label>
          <input type="number" id="seed" placeholder="Palikite tuščią..." />
        </div>
        <div class="option">
          <label for="imageOptions">Kiek paveikslėlių:</label>
          <input type="number" id="imageOptions" value="1" min="1" max="10" />
        </div>
        <div class="option">
          <label for="style">Stilius:</label>
          <select id="style">
            <option value="None">None</option>
            <option value="Film">Film</option>
            <option value="Pixel Art">Pixel Art</option>
            <option value="Anime">Anime</option>
            <option value="Realistic">Realistic</option>
            <option value="Mix">Mix</option>
            <option value="Storyboard">Storyboard</option>
            <option value="Film Noir">Film Noir</option>
            <option value="Vintage">Vintage</option>
            <option value="Graphic Design">Graphic Design</option>
            <option value="Cartoon">Cartoon</option>
            <option value="Watercolor">Watercolor</option>
            <option value="Surrealism">Surrealism</option>
            <option value="Comics Style">Comics Style</option>
          </select>
        </div>
      </div>
      <!-- Camera Features and Colors Section -->
      <div class="camera-color-section">
        <h2>Select Camera Feature</h2>
        <select id="cameraFeatures" onchange="showCameraFeature()">
          <option value="">Select a feature</option>
          <option value="360 Panorama">360 Panorama</option>
          <option value="DSLR">DSLR</option>
          <option value="Electron Microscope">Electron Microscope</option>
          <option value="Macro Lens">Macro Lens</option>
          <option value="Magnification">Magnification</option>
          <option value="Microscopy">Microscopy</option>
          <option value="Miniature Faking">Miniature Faking</option>
          <option value="Panorama">Panorama</option>
          <option value="Pinhole Lens">Pinhole Lens</option>
          <option value="Satellite Imagery">Satellite Imagery</option>
          <option value="Super Resolution Microscopy">Super Resolution Microscopy</option>
          <option value="Telephoto Lens">Telephoto Lens</option>
          <option value="Telescope Lens">Telescope Lens</option>
          <option value="Ultra Wide Angle Lens">Ultra Wide Angle Lens</option>
          <option value="Wide Angle Lens">Wide Angle Lens</option>
        </select>
        <div id="cameraFeatureDescription" class="description"></div>

        <h2>Select Color</h2>
        <select id="colors" onchange="showColor()">
          <option value="">Select a color</option>
          <option value="Baby Blue Color">Baby Blue Color</option>
          <option value="Baby Pink Color">Baby Pink Color</option>
          <option value="Beige">Beige</option>
          <option value="Blue">Blue</option>
          <option value="Brown Color">Brown Color</option>
          <option value="Citrus">Citrus</option>
          <option value="Coquelicot Color">Coquelicot Color</option>
          <option value="Cyan">Cyan</option>
          <option value="CYMK">CYMK</option>
          <option value="Gold Color">Gold Color</option>
          <option value="Gray">Gray</option>
          <option value="Grayscale Color">Grayscale Color</option>
          <option value="Green">Green</option>
          <option value="Hot Pink Color">Hot Pink Color</option>
          <option value="Indigo">Indigo</option>
          <option value="Lavender Color">Lavender Color</option>
          <option value="Magenta">Magenta</option>
          <option value="Matte Black Color">Matte Black Color</option>
          <option value="Mint Color">Mint Color</option>
          <option value="Navy Blue">Navy Blue</option>
          <option value="Neon Blue Color">Neon Blue Color</option>
          <option value="Neon Green Color">Neon Green Color</option>
          <option value="Neon Orange Color">Neon Orange Color</option>
          <option value="Neon Purple Color">Neon Purple Color</option>
          <option value="Neon Red Color">Neon Red Color</option>
          <option value="Neon Yellow Color">Neon Yellow Color</option>
          <option value="Orange">Orange</option>
          <option value="Pink">Pink</option>
          <option value="Red">Red</option>
          <option value="RGB">RGB</option>
          <option value="Silver Color">Silver Color</option>
          <option value="Teal">Teal</option>
          <option value="Turquoise">Turquoise</option>
          <option value="Vermillion">Vermillion</option>
          <option value="Violet">Violet</option>
          <option value="White">White</option>
          <option value="Yellow">Yellow</option>
        </select>
        <div id="colorDescription" class="description"></div>
      </div>
      <div class="buttons">
        <button class="generate" onclick="generateImage()"><i class="fas fa-magic"></i> GENERUOTI</button>
        <button class="auto-toggle" onclick="toggleAutoMode()" id="autoToggleBtn" data-tooltip="Automatiškai optimizuoja aprašymus naudojant AI"><i class="fas fa-robot"></i> AUTO OFF</button>
        <button class="dark-mode-toggle" onclick="toggleDarkMode()"><i class="fas fa-moon"></i> 🌙</button>
      </div>
      <!-- Progress Bar -->
      <div class="progress-container" id="progressContainer" hidden>
        <div class="progress-bar" id="progressBar"></div>
      </div>
      <div class="generated-image" id="generatedImage"></div>
      <!-- Loading Indicator -->
      <div class="overlay" id="overlay">
        <div class="loader"></div>
        <div id="timer">Generuojama: 0s</div>
        <!-- Progress Bar -->
        <div class="progress-container" id="progressOverlay" hidden>
          <div class="progress-bar" id="progressOverlayBar"></div>
        </div>
      </div>
    </div>

    <!-- Library Container -->
    <div class="library-container" id="libraryContainer">
      <h2>Library</h2>
      <div class="generated-image" id="libraryImages">
        <!-- Saved images will appear here -->
      </div>
      <div class="buttons">
        <button class="generate" onclick="showGenerator()"><i class="fas fa-arrow-left"></i> GENERATOR</button>
        <button class="download" onclick="downloadAllLibraryImages()"><i class="fas fa-download"></i> ATSISIŲSTI VISKĄ</button>
        <button class="clear-library" onclick="clearLibrary()"><i class="fas fa-trash-alt"></i> IŠVALYTI LIBRARY</button>
      </div>
    </div>
  </div>
  
  <!-- Modal for Fullscreen Image -->
  <div id="imageModal" class="modal">
    <span class="close">&times;</span>
    <img class="modal-content" id="modalImage">
  </div>

  <footer>
    <p>
      API dokumentacija:
      <a href="https://github.com/pollinations/pollinations/blob/master/APIDOCS.md" target="_blank">Pollinations.AI GitHub</a>
    </p>
    <p>
      Sukurta su ❤️ naudojant
      <a href="https://pollinations.ai/" target="_blank">Pollinations.AI</a>.
    </p>
  </footer>

  <script>
    let timerInterval;
    let autoMode = false;
    let totalImages = 0;
    let generatedImagesCount = 0;

    // Save settings to localStorage
    function saveSettings() {
      const backgroundPrompt = document.getElementById('backgroundPrompt').value;
      const characterPrompt = document.getElementById('characterPrompt').value;
      const negativePrompt = document.getElementById('negativePrompt').value;
      const model = document.getElementById('model').value;
      const width = document.getElementById('width').value;
      const height = document.getElementById('height').value;
      const seed = document.getElementById('seed').value;
      const imageOptions = document.getElementById('imageOptions').value;
      const style = document.getElementById('style').value;
      const cameraFeature = document.getElementById('cameraFeatures').value;
      const color = document.getElementById('colors').value;

      // Collect additional character descriptions
      const additionalCharacterDescriptions = [];
      const additionalGroups = document.querySelectorAll('.additional-character-group textarea');
      additionalGroups.forEach(textarea => {
        const desc = textarea.value.trim();
        if (desc) {
          additionalCharacterDescriptions.push(desc);
        }
      });

      localStorage.setItem('backgroundPrompt', backgroundPrompt);
      localStorage.setItem('characterPrompt', characterPrompt);
      localStorage.setItem('negativePrompt', negativePrompt);
      localStorage.setItem('model', model);
      localStorage.setItem('width', width);
      localStorage.setItem('height', height);
      localStorage.setItem('seed', seed);
      localStorage.setItem('imageOptions', imageOptions);
      localStorage.setItem('style', style);
      localStorage.setItem('cameraFeature', cameraFeature);
      localStorage.setItem('color', color);
      localStorage.setItem('autoMode', autoMode);
      localStorage.setItem('additionalCharacterDescriptions', JSON.stringify(additionalCharacterDescriptions));
    }

    // Load settings from localStorage
    function loadSettings() {
      const backgroundPrompt = localStorage.getItem('backgroundPrompt');
      const characterPrompt = localStorage.getItem('characterPrompt');
      const negativePrompt = localStorage.getItem('negativePrompt');
      const model = localStorage.getItem('model');
      const width = localStorage.getItem('width');
      const height = localStorage.getItem('height');
      const seed = localStorage.getItem('seed');
      const imageOptions = localStorage.getItem('imageOptions');
      const style = localStorage.getItem('style');
      const cameraFeature = localStorage.getItem('cameraFeature');
      const color = localStorage.getItem('color');
      const savedAutoMode = localStorage.getItem('autoMode');
      const additionalCharacterDescriptions = JSON.parse(localStorage.getItem('additionalCharacterDescriptions') || '[]');

      if (backgroundPrompt) document.getElementById('backgroundPrompt').value = backgroundPrompt;
      if (characterPrompt) document.getElementById('characterPrompt').value = characterPrompt;
      if (negativePrompt) document.getElementById('negativePrompt').value = negativePrompt;
      if (model) document.getElementById('model').value = model;
      if (width) document.getElementById('width').value = width;
      if (height) document.getElementById('height').value = height;
      if (seed) document.getElementById('seed').value = seed;
      if (imageOptions) document.getElementById('imageOptions').value = imageOptions;
      if (style) document.getElementById('style').value = style;
      if (cameraFeature) document.getElementById('cameraFeatures').value = cameraFeature;
      if (color) document.getElementById('colors').value = color;

      if (savedAutoMode === 'true') {
        autoMode = true;
        document.getElementById('autoToggleBtn').classList.add('active');
        document.getElementById('autoToggleBtn').innerHTML = '<i class="fas fa-robot"></i> AUTO ON';
      } else {
        autoMode = false;
        document.getElementById('autoToggleBtn').classList.remove('active');
        document.getElementById('autoToggleBtn').innerHTML = '<i class="fas fa-robot"></i> AUTO OFF';
      }

      // Load additional character descriptions
      additionalCharacterDescriptions.forEach(desc => {
        addCharacterDescription(desc);
      });
    }

    // Initial load
    document.addEventListener('DOMContentLoaded', () => {
      loadSettings();
      loadDarkMode();
      setupModal();
      initializeNegativePrompt();
      loadGeneratedImages();
      loadLibraryImages();
      disableImageDownload();
    });

    // Initialize Negative Prompt with default text if empty
    function initializeNegativePrompt() {
      const negativePrompt = document.getElementById('negativePrompt');
      if (!negativePrompt.value) {
        negativePrompt.value = "low quality, blurry, bad anatomy, out of focus, noise, duplicate, watermark, text, ugly, messy";
      }
    }

    // Dark Mode Toggle
    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
      const toggleBtn = document.querySelector('.dark-mode-toggle');
      if (document.body.classList.contains('dark-mode')) {
        toggleBtn.innerHTML = '<i class="fas fa-sun"></i> ☀️';
      } else {
        toggleBtn.innerHTML = '<i class="fas fa-moon"></i> 🌙';
      }
      localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
    }

    // Load Dark Mode settings
    function loadDarkMode() {
      const darkMode = localStorage.getItem('darkMode');
      if (darkMode === 'true') {
        document.body.classList.add('dark-mode');
        document.querySelector('.dark-mode-toggle').innerHTML = '<i class="fas fa-sun"></i> ☀️';
      } else {
        document.querySelector('.dark-mode-toggle').innerHTML = '<i class="fas fa-moon"></i> 🌙';
      }
    }

    // Auto Mode Toggle
    function toggleAutoMode() {
      autoMode = !autoMode;
      const toggleBtn = document.getElementById('autoToggleBtn');
      if (autoMode) {
        toggleBtn.classList.add('active');
        toggleBtn.innerHTML = '<i class="fas fa-robot"></i> AUTO ON';
      } else {
        toggleBtn.classList.remove('active');
        toggleBtn.innerHTML = '<i class="fas fa-robot"></i> AUTO OFF';
      }
      localStorage.setItem('autoMode', autoMode);
    }

    // Append Style to Prompt
    function appendStyleToPrompt(prompt, style) {
      const styleDescriptions = {
        'Film': `${prompt}, cinematic masterpiece, shot with an anamorphic 35mm lens, ultra-wide aspect ratio, natural film grain, rich and moody cinematic color palette, deep contrast, dynamic range, soft and detailed lighting, natural bokeh, shallow depth of field, evocative storytelling, authentic vintage film aesthetics, timeless Hollywood style`,
        'Pixel Art': `${prompt}, in classic pixel art style, inspired by retro games like Final Fantasy and Chrono Trigger, 16-bit aesthetic, carefully crafted pixel details, balanced color palette, nostalgic and vibrant tones, smooth shading, and authentic retro charm`,
        'Anime': `${prompt}, in anime style inspired by classics like Attack on Titan and Demon Slayer, vivid and dynamic compositions, vibrant yet harmonious color schemes, expressive and detailed character designs, dramatic lighting, intricate line work, fluid motion elements, and a cinematic anime atmosphere`,
        'Realistic': `${prompt}, in hyper-realistic style, photorealistic details, meticulously rendered textures, lifelike proportions, dynamic and natural lighting, realistic depth of field, authentic environments, nuanced color grading, and true-to-life materials`,
        'Storyboard': `${prompt}, in hand-drawn black-and-white storyboard style, rough pencil sketch aesthetic, emphasizing composition, perspective, and dynamic camera angles, clear character blocking, cinematic framing, sequential flow, and annotations for action and dialogue cues`,
        'Film Noir': `${prompt}, in classic film noir style, high contrast black-and-white imagery, dramatic chiaroscuro lighting, deep shadows, atmospheric fog, urban backdrops, vintage aesthetics, fedoras and trench coats, suspenseful mood, and intense character expressions`,
        'Vintage': `${prompt}, in vintage style, muted and earthy color palette, soft film grain, faded textures, timeless composition, delicate vignetting, nostalgic atmosphere, classic typography, and retro-inspired design elements`,
        'Graphic Design': `${prompt}, in modern graphic design style, clean and balanced layouts, bold typography, striking color palettes, geometric shapes, high contrast, minimalist aesthetics, layered compositions, and visually compelling visuals tailored for branding or digital media`,
        'Cartoon': `${prompt}, in Cartoon Network-inspired style, bold and dynamic outlines, exaggerated yet balanced proportions, quirky character designs, vibrant and contrasting color palettes, playful and expressive animations, simplified but impactful backgrounds, lighthearted tone, and a touch of surreal humor reminiscent of shows like Adventure Time, The Amazing World of Gumball, and Dexter's Laboratory`,
        'Watercolor': `${prompt}, in delicate watercolor painting style, soft brush strokes, pastel and muted tones, organic textures, flowing gradients, and a dreamy, artistic atmosphere reminiscent of classic hand-painted illustrations`,
        'Surrealism': `${prompt}, in surreal style, dreamlike imagery, abstract forms, unconventional compositions, and a blend of reality and imagination, reminiscent of Salvador Dalí's artworks`,
        'Comics Style': `${prompt}, in vibrant comics style, bold black outlines, dynamic panel compositions, expressive character poses, exaggerated proportions, halftone patterns, action-packed scenes, vibrant primary colors, dramatic speech bubbles, and a storytelling aesthetic reminiscent of Marvel and DC classics`,
        'Mix': appendMixStyleToPrompt(prompt)
      };
      return styleDescriptions[style] || prompt;
    }

    // Get Random Styles for Mix
    function getRandomStyles() {
      const styles = ['Film', 'Pixel Art', 'Anime', 'Realistic', 'Storyboard', 'Film Noir', 'Vintage', 'Graphic Design', 'Cartoon', 'Watercolor', 'Surrealism', 'Comics Style'];
      let first = styles[Math.floor(Math.random() * styles.length)];
      let second = styles[Math.floor(Math.random() * styles.length)];
      while (second === first) {
        second = styles[Math.floor(Math.random() * styles.length)];
      }
      return `${first} and ${second}`;
    }

    // Append Mix Style to Prompt
    function appendMixStyleToPrompt(prompt) {
      const randomStyles = getRandomStyles();
      return `${prompt}, in ${randomStyles} styles, combining elements from both styles for a unique and engaging image`;
    }

    // Modal Configuration
    function setupModal() {
      const modal = document.getElementById("imageModal");
      const modalImg = document.getElementById("modalImage");
      const closeBtn = document.getElementsByClassName("close")[0];

      // Close modal
      closeBtn.onclick = function() { 
        modal.style.display = "none";
      }

      // Close modal when clicking outside the image
      window.onclick = function(event) {
        if (event.target == modal) {
          modal.style.display = "none";
        }
      }

      // Open modal on image click (Generator)
      document.getElementById('generatedImage').addEventListener('click', function(event) {
        if(event.target.tagName === 'IMG') {
          modal.style.display = "block";
          modalImg.src = event.target.src;
        }
      });

      // Open modal on image click (Library)
      document.getElementById('libraryImages').addEventListener('click', function(event) {
        if(event.target.tagName === 'IMG') {
          modal.style.display = "block";
          modalImg.src = event.target.src;
        }
      });
    }

    // Add Additional Character Description
    function addCharacterDescription(description = '') {
      const container = document.getElementById('additionalCharacterDescriptions');
      
      const descriptionCount = container.children.length;
      if (descriptionCount >= 5) { // Limit to 5 additional descriptions
        alert('Galite pridėti iki 5 papildomų personažo aprašymų.');
        return;
      }

      const newGroup = document.createElement('div');
      newGroup.classList.add('input-group', 'additional-character-group');

      const label = document.createElement('label');
      label.textContent = `Additional Character Description ${descriptionCount + 1}:`;
      label.setAttribute('for', `additionalCharacterPrompt${descriptionCount + 1}`);

      const textarea = document.createElement('textarea');
      textarea.id = `additionalCharacterPrompt${descriptionCount + 1}`;
      textarea.placeholder = 'Pvz., ilgasis šaknys, puikiai sutvarkyta šviesa...';
      textarea.value = description;

      const removeBtn = document.createElement('button');
      removeBtn.type = 'button';
      removeBtn.textContent = '–'; // Remove button
      removeBtn.title = 'Pašalinti šį aprašymą';
      removeBtn.onclick = () => {
        container.removeChild(newGroup);
        saveSettings(); // Save changes
      };

      newGroup.appendChild(label);
      newGroup.appendChild(textarea);
      newGroup.appendChild(removeBtn);

      container.appendChild(newGroup);
    }

    // Show Library
    function showLibrary() {
      document.getElementById('generatorContainer').classList.remove('active');
      document.getElementById('libraryContainer').classList.add('active');
      disableImageDownload(); // Ensure new images have download disabled
    }

    // Show Generator
    function showGenerator() {
      document.getElementById('libraryContainer').classList.remove('active');
      document.getElementById('generatorContainer').classList.add('active');
      disableImageDownload(); // Ensure new images have download disabled
    }

    // Add Image to Library Gallery
    function addImageToLibraryGallery(url, prompt, model, width, height, seed, mimeType) {
      const libraryImagesDiv = document.getElementById('libraryImages');
      const imageContainer = document.createElement('div');
      imageContainer.classList.add('image-container');

      const imgElement = document.createElement('img');
      imgElement.src = url;
      imgElement.alt = 'Sugeneruotas vaizdas';
      imgElement.title = 'Spauskite norėdami padidinti';
      imgElement.dataset.type = mimeType; // Store MIME type for correct file extension
      imageContainer.appendChild(imgElement);

      // Add caption
      const caption = document.createElement('div');
      caption.classList.add('caption');
      caption.innerHTML = `
        <strong>Prompt:</strong> ${prompt}<br>
        <strong>Model:</strong> ${model}<br>
        <strong>Dimensions:</strong> ${width}px x ${height}px<br>
        <strong>Seed:</strong> ${seed}
      `;
      imageContainer.appendChild(caption);

      // Add download options
      const downloadOptions = document.createElement('div');
      downloadOptions.classList.add('download-options');

      const formatSelect = document.createElement('select');
      formatSelect.innerHTML = `
        <option value="png">PNG</option>
        <option value="jpg">JPG</option>
        <option value="webp">WEBP</option>
      `;
      downloadOptions.appendChild(formatSelect);

      const downloadBtn = document.createElement('button');
      downloadBtn.innerHTML = '<i class="fas fa-download"></i> Download';
      downloadBtn.onclick = () => {
        const format = formatSelect.value;
        downloadImage(url, `hexacola_image_${seed}.${format}`, format);
      };
      downloadOptions.appendChild(downloadBtn);

      imageContainer.appendChild(downloadOptions);

      libraryImagesDiv.appendChild(imageContainer);
    }

    // Download Image in Selected Format
    async function downloadImage(url, filename, format) {
      try {
        const response = await fetch(url);
        const blob = await response.blob();
        let convertedBlob = blob;

        if (format !== blob.type.split('/')[1]) {
          const imageBitmap = await createImageBitmap(blob);
          const canvas = document.createElement('canvas');
          canvas.width = imageBitmap.width;
          canvas.height = imageBitmap.height;
          const ctx = canvas.getContext('2d');
          ctx.drawImage(imageBitmap, 0, 0);
          convertedBlob = await new Promise(resolve => canvas.toBlob(resolve, `image/${format}`));
        }

        const a = document.createElement('a');
        a.href = URL.createObjectURL(convertedBlob);
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      } catch (error) {
        console.error('Atsisiuntimo klaida:', error);
        alert('Klaida atsisiunčiant vaizdą. Bandykite dar kartą.');
      }
    }

    // Load Library Images
    function loadLibraryImages() {
      let images = JSON.parse(localStorage.getItem('generatedImages')) || [];
      images.forEach(image => {
        addImageToLibraryGallery(image.url, image.prompt, image.model, image.width, image.height, image.seed, image.mimeType);
      });
    }

    // Clear Library
    function clearLibrary() {
      if (confirm('Ar tikrai norite išvalyti visus vaizdus iš bibliotekos?')) {
        localStorage.removeItem('generatedImages');
        document.getElementById('libraryImages').innerHTML = '';
        alert('Library sėkmingai išvalyta.');
      }
    }

    // Generate Image
    async function generateImage() {
      const generateButton = document.querySelector('.generate');
      generateButton.disabled = true; // Disable button during generation

      const backgroundPrompt = document.getElementById('backgroundPrompt').value.trim();
      const characterPrompt = document.getElementById('characterPrompt').value.trim();
      const negativePrompt = document.getElementById('negativePrompt').value.trim();
      const model = document.getElementById('model').value;
      const width = document.getElementById('width').value;
      const height = document.getElementById('height').value;
      const seed = document.getElementById('seed').value;
      const imageOptions = parseInt(document.getElementById('imageOptions').value);
      const style = document.getElementById('style').value;
      const cameraFeature = document.getElementById('cameraFeatures').value;
      const color = document.getElementById('colors').value;

      // Collect additional character descriptions
      const additionalCharacterDescriptions = [];
      const additionalGroups = document.querySelectorAll('.additional-character-group textarea');
      additionalGroups.forEach(textarea => {
        const desc = textarea.value.trim();
        if (desc) {
          additionalCharacterDescriptions.push(desc);
        }
      });

      // Check if no prompts are provided
      const noPrompts = !backgroundPrompt && !characterPrompt && additionalCharacterDescriptions.length === 0;

      let backgroundCombinedPrompt = '';
      let characterCombinedPrompt = '';

      if (noPrompts) {
        // Generate both background and character prompts if none provided
        try {
          [backgroundCombinedPrompt, characterCombinedPrompt] = await Promise.all([
            generateRandomPromptFunction('background', style, cameraFeature, color),
            generateRandomPromptFunction('character', style, cameraFeature, color)
          ]);
          // Assign generated prompts
          document.getElementById('backgroundPrompt').value = backgroundCombinedPrompt;
          document.getElementById('characterPrompt').value = characterCombinedPrompt;
        } catch (error) {
          console.error(error);
          alert('Nepavyko sugeneruoti atsitiktinio aprašymo. Bandykite dar kartą.');
          generateButton.disabled = false;
          return;
        }
      } else {
        // If at least one prompt is provided, use them as is
        if (backgroundPrompt) {
          backgroundCombinedPrompt = backgroundPrompt;
        }
        if (characterPrompt) {
          characterCombinedPrompt = characterPrompt;
        }
      }

      // Ensure at least one prompt is present
      if ((!backgroundCombinedPrompt && !characterCombinedPrompt)) {
        alert('Prašome įvesti bent vieną fono arba personažo aprašymą.');
        generateButton.disabled = false;
        return;
      }

      saveSettings();

      let optimizedBackgroundPrompt = backgroundCombinedPrompt;
      let optimizedCharacterPrompt = characterCombinedPrompt;
      let optimizedNegativePrompt = "low quality, blurry, bad anatomy, out of focus, noise, duplicate, watermark, text, ugly, messy, " + negativePrompt;

      if (autoMode) {
        try {
          // Optimize background prompt with style, camera feature, and color
          if (backgroundCombinedPrompt) {
            optimizedBackgroundPrompt = await optimizePrompt(`Optimize the following background prompt for high-quality image generation in ${style} style with camera feature ${cameraFeature} and color ${color}: "${backgroundCombinedPrompt}"`);
          }

          // Optimize character prompt with style, camera feature, and color
          if (characterCombinedPrompt) {
            optimizedCharacterPrompt = await optimizePrompt(`Optimize the following character prompt for high-quality image generation in ${style} style with camera feature ${cameraFeature} and color ${color}: "${characterCombinedPrompt}"`);
          }

          // Optimize each additional character description
          for (let i = 0; i < additionalCharacterDescriptions.length; i++) {
            additionalCharacterDescriptions[i] = await optimizePrompt(`Optimize the following character description to match the ${style} style with camera feature ${cameraFeature} and color ${color}: "${additionalCharacterDescriptions[i]}"`);
          }

          // Optimize negative prompt
          if (negativePrompt) {
            optimizedNegativePrompt = "low quality, blurry, bad anatomy, out of focus, noise, duplicate, watermark, text, ugly, messy, " + await optimizePrompt(`Optimize the following negative prompt to exclude unwanted elements: "${negativePrompt}"`);
          }
        } catch (error) {
          console.error(error);
          alert('Klaida optimizuojant aprašymus su AI. Bandykite dar kartą.');
          generateButton.disabled = false;
          return;
        }
      }

      // Integrate additional character descriptions
      let fullCharacterPrompt = optimizedCharacterPrompt;
      if (additionalCharacterDescriptions.length > 0) {
        fullCharacterPrompt += ' ' + additionalCharacterDescriptions.join(' ');
        fullCharacterPrompt += ' Ensure that all characters maintain the same style, face structure, and clothing as described above.';
      }

      // Integrate camera feature and color into the combined prompt
      let combinedPrompt = '';
      if (optimizedBackgroundPrompt && fullCharacterPrompt) {
        combinedPrompt = `${optimizedBackgroundPrompt}, ${fullCharacterPrompt}, with correct proportions, good perspective, and excellent composition.`;
      } else if (optimizedBackgroundPrompt) {
        combinedPrompt = `${optimizedBackgroundPrompt}, with correct proportions, good perspective, and excellent composition.`;
      } else if (fullCharacterPrompt) {
        combinedPrompt = `${fullCharacterPrompt}, with correct proportions, good perspective, and excellent composition.`;
      }

      // Append style
      if (style === 'Mix') {
        combinedPrompt = appendMixStyleToPrompt(combinedPrompt);
      } else if (style !== 'None') {
        combinedPrompt = appendStyleToPrompt(combinedPrompt, style);
      }

      // Append camera feature and color descriptions at the beginning for top priority
      if (cameraFeature) {
        combinedPrompt = `${cameraFeature}, ${combinedPrompt}`;
      }
      if (color) {
        combinedPrompt = `${color}, ${combinedPrompt}`;
      }

      // Create API URL
      let urlBase = `https://image.pollinations.ai/prompt/${encodeURIComponent(combinedPrompt)}?model=${encodeURIComponent(model)}&width=${encodeURIComponent(width)}&height=${encodeURIComponent(height)}&nologo=true`;

      if (negativePrompt) {
        urlBase += `&negative=${encodeURIComponent(optimizedNegativePrompt)}`;
      }

      try {
        // Show loading overlay and start timer
        const overlay = document.getElementById('overlay');
        const timer = document.getElementById('timer');
        const progressOverlay = document.getElementById('progressOverlay');
        const progressOverlayBar = document.getElementById('progressOverlayBar');
        overlay.style.display = 'flex';
        progressOverlay.style.display = 'block';
        let seconds = 0;
        timer.textContent = `Generuojama: ${seconds}s`;
        timerInterval = setInterval(() => {
          seconds++;
          timer.textContent = `Generuojama: ${seconds}s`;
        }, 1000);

        // Initialize progress bar
        totalImages = imageOptions;
        generatedImagesCount = 0;
        updateProgressBar();

        // Clear previous generated images
        const generatedImageDiv = document.getElementById('generatedImage');
        generatedImageDiv.innerHTML = '';

        // Generate images concurrently with unique seeds
        const promises = [];
        for (let i = 0; i < imageOptions; i++) {
          let uniqueSeed;
          if (seed) {
            uniqueSeed = parseInt(seed) + i; // Increment seed
          } else {
            uniqueSeed = Math.floor(Math.random() * 100000); // Random seed
          }
          const url = `${urlBase}&seed=${encodeURIComponent(uniqueSeed)}`;
          promises.push(fetch(url).then(response => {
            if (!response.ok) {
              throw new Error('Nepavyko sugeneruoti vaizdo.');
            }
            return response.blob();
          }).catch(error => {
            console.error(`Vaizdo generavimo klaida (Seed: ${uniqueSeed}):`, error);
            return null;
          }));
        }

        const blobs = await Promise.all(promises);
        blobs.forEach((blob, index) => {
          if (blob) {
            const imgUrl = URL.createObjectURL(blob);
            const imageContainer = document.createElement('div');
            imageContainer.classList.add('image-container');

            const imgElement = document.createElement('img');
            imgElement.src = imgUrl;
            imgElement.alt = 'Sugeneruotas vaizdas';
            imgElement.title = 'Spauskite norėdami padidinti';
            imgElement.dataset.type = blob.type; // Store MIME type
            imageContainer.appendChild(imgElement);

            // Add caption
            const caption = document.createElement('div');
            caption.classList.add('caption');
            caption.innerHTML = `
              <strong>Prompt:</strong> ${combinedPrompt}<br>
              <strong>Model:</strong> ${model}<br>
              <strong>Dimensions:</strong> ${width}px x ${height}px<br>
              <strong>Seed:</strong> ${seed ? uniqueSeed : 'Random'}
            `;
            imageContainer.appendChild(caption);

            // Add download options
            const downloadOptions = document.createElement('div');
            downloadOptions.classList.add('download-options');

            const formatSelect = document.createElement('select');
            formatSelect.innerHTML = `
              <option value="png">PNG</option>
              <option value="jpg">JPG</option>
              <option value="webp">WEBP</option>
            `;
            downloadOptions.appendChild(formatSelect);

            const downloadBtn = document.createElement('button');
            downloadBtn.innerHTML = '<i class="fas fa-download"></i> Download';
            downloadBtn.onclick = () => {
              const format = formatSelect.value;
              downloadImage(imgUrl, `hexacola_image_${seed ? uniqueSeed : index + 1}.${format}`, format);
            };
            downloadOptions.appendChild(downloadBtn);

            imageContainer.appendChild(downloadOptions);

            generatedImageDiv.appendChild(imageContainer);

            // Save image to localStorage
            saveImage(imgUrl, combinedPrompt, model, width, height, seed ? uniqueSeed : 'Random', blob.type);
            // Add to library
            addImageToLibraryGallery(imgUrl, combinedPrompt, model, width, height, seed ? uniqueSeed : 'Random', blob.type);

            // Update progress bar
            generatedImagesCount++;
            updateProgressBar();
          } else {
            // Even if image generation failed, update progress
            generatedImagesCount++;
            updateProgressBar();
          }
        });
      } catch (error) {
        console.error(error);
        alert('Klaida generuojant vaizdą. Bandykite dar kartą.');
        document.getElementById('generatedImage').innerHTML = '';
      } finally {
        // Hide loading overlay and stop timer
        document.getElementById('overlay').style.display = 'none';
        clearInterval(timerInterval);
        generateButton.disabled = false;
        document.getElementById('progressOverlay').style.display = 'none';
        disableImageDownload();
      }
    }

    // Download All Library Images
    async function downloadAllLibraryImages() {
      const images = document.querySelectorAll('#libraryImages img');
      if (images.length === 0) {
        alert('Nėra vaizdų atsisiuntimui.');
        return;
      }
      images.forEach((img, index) => {
        const mimeType = img.dataset.type || 'image/png'; // Default to png if type not found
        const extension = mimeType.split('/')[1] || 'png';
        const a = document.createElement('a');
        a.href = img.src;
        a.download = `hexacola_image_${index + 1}.${extension}`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      });
    }

    // Update Progress Bar
    function updateProgressBar() {
      const progressBar = document.getElementById('progressOverlayBar');
      const progressPercentage = (generatedImagesCount / totalImages) * 100;
      progressBar.style.width = `${progressPercentage}%`;
      if (progressPercentage >= 100) {
        progressBar.style.backgroundColor = '#4caf50'; // Green when complete
      }
    }

    // Optimize Prompt using Pollinations.AI API
    async function optimizePrompt(prompt) {
      const response = await fetch('https://text.pollinations.ai/openai', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          messages: [
            { role: 'system', content: 'Tu esi Hexacola GPT – kūrybingas ir universalus AI įrankis, skirtas generuoti aukštos kokybės promptus ir vaizdus, optimizuotus su Pollinations.AI. Tavo specializacija – kurti unikalius personažų aprašymus, įtraukiančius pasaulių fonus (backgrounds), detalizuotus scenarijus ir stilingus vaizdinius aprašymus, kurie puikiai dera su Pollinations.AI vaizdų generavimo galimybėmis. Tu atsižvelgi į stilistiką, spalvų paletę, kompoziciją ir vartotojo pageidavimus, siekdamas išlaikyti geriausią vaizdo ir teksto kokybę. Tu visada sieki kokybiškų nuotraukų ir vaizdų, atsižvelgiant į detalumą ir estetiką. Tavo tikslas – pateikti įkvepiančius ir estetiškai harmoningus rezultatus, pritaikomus literatūrai, žaidimų dizainui, audiovizualiniams projektams ir kūrybinei saviraiškai.' },
            { role: 'user', content: prompt }
          ],
          model: 'openai', // Pollinations.AI default model
          seed: Math.floor(Math.random() * 100000),
          jsonMode: false
        }),
      });

      if (!response.ok) {
        throw new Error('Nepavyko susisiekti su AI paslauga.');
      }

      const data = await response.json();
      if (data.choices && data.choices.length > 0 && data.choices[0].message) {
        const optimizedPrompt = data.choices[0].message.content;
        return optimizedPrompt.trim();
      } else {
        throw new Error('Neteisingas AI atsakymas.');
      }
    }

    // Generate Random Prompt Function
    async function generateRandomPromptFunction(target, style, cameraFeature, color) {
      let basePrompt = '';
      if (target === 'background') {
        basePrompt = 'Generate a creative and detailed description for a background of an AI-generated image that is unique and visually appealing. Ensure it is suitable for a high-quality image generation with appropriate style adaptations.';
      } else if (target === 'character') {
        basePrompt = 'Generate a creative and detailed description for a character of an AI-generated image that is unique and visually appealing. Ensure it is suitable for a high-quality image generation with appropriate style adaptations.';
      } else {
        throw new Error('Invalid target for prompt generation.');
      }

      // Integrate camera feature and color for top priority
      let enhancedPrompt = '';
      if (cameraFeature) {
        enhancedPrompt += `${cameraFeature}, `;
      }
      if (color) {
        enhancedPrompt += `${color}, `;
      }
      enhancedPrompt += basePrompt;

      const response = await fetch('https://text.pollinations.ai/openai', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          messages: [
            { role: 'system', content: 'Tu esi Hexacola GPT – kūrybingas ir universalus AI įrankis, skirtas generuoti aukštos kokybės promptus ir vaizdus, optimizuotus su Pollinations.AI. Tavo specializacija – kurti unikalius personažų aprašymus, įtraukiančius pasaulių fonus (backgrounds), detalizuotus scenarijus ir stilingus vaizdinius aprašymus, kurie puikiai dera su Pollinations.AI vaizdų generavimo galimybėmis. Tu atsižvelgi į stilistiką, spalvų paletę, kompoziciją ir vartotojo pageidavimus, siekdamas išlaikyti geriausią vaizdo ir teksto kokybę. Tu visada sieki kokybiškų nuotraukų ir vaizdų, atsižvelgiant į detalumą ir estetiką. Tavo tikslas – pateikti įkvepiančius ir estetiškai harmoningus rezultatus, pritaikomus literatūrai, žaidimų dizainui, audiovizualiniams projektams ir kūrybinei saviraiškai.' },
            { role: 'user', content: enhancedPrompt }
          ],
          model: 'openai', // Pollinations.AI default model
          seed: Math.floor(Math.random() * 100000),
          jsonMode: false
        }),
      });

      if (!response.ok) {
        throw new Error('Nepavyko susisiekti su AI paslauga.');
      }

      const data = await response.json();
      if (data.choices && data.choices.length > 0 && data.choices[0].message) {
        let generatedPrompt = data.choices[0].message.content;
        generatedPrompt = generatedPrompt.trim();

        // Apply style if selected
        if (style && style !== 'None') {
          generatedPrompt = appendStyleToPrompt(generatedPrompt, style);
        }

        return generatedPrompt;
      } else {
        throw new Error('Neteisingas AI atsakymas.');
      }
    }

    // Generate Random Prompt
    async function generateRandomPrompt(target) {
      const style = document.getElementById('style').value;
      const cameraFeature = document.getElementById('cameraFeatures').value;
      const color = document.getElementById('colors').value;
      const generateButtons = document.querySelectorAll('.generate-prompt');
      generateButtons.forEach(button => button.disabled = true); // Disable all prompt buttons during generation

      try {
        const prompt = await generateRandomPromptFunction(target, style, cameraFeature, color);
        if (target === 'background') {
          document.getElementById('backgroundPrompt').value = prompt;
        } else if (target === 'character') {
          document.getElementById('characterPrompt').value = prompt;
        }
        alert(`Sėkmingai sugeneruotas ${target} aprašymas!`);
      } catch (error) {
        console.error(error);
        alert('Klaida generuojant aprašymą. Bandykite dar kartą.');
      } finally {
        generateButtons.forEach(button => button.disabled = false); // Re-enable buttons after generation
      }
    }

    // Chat Functionality
    async function sendMessage() {
      const chatInput = document.getElementById('chatInput');
      const message = chatInput.value.trim();
      if (message === '') return;

      appendMessage('user', message);
      chatInput.value = '';

      try {
        const response = await fetch('https://text.pollinations.ai/openai', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            messages: [
              { role: 'system', content: 'Tu esi Hexacola GPT – kūrybingas ir universalus AI įrankis, skirtas generuoti aukštos kokybės promptus ir vaizdus, optimizuotus su Pollinations.AI. Tavo specializacija – kurti unikalius personažų aprašymus, įtraukiančius pasaulių fonus (backgrounds), detalizuotus scenarijus ir stilingus vaizdinius aprašymus, kurie puikiai dera su Pollinations.AI vaizdų generavimo galimybėmis. Tu atsižvelgi į stilistiką, spalvų paletę, kompoziciją ir vartotojo pageidavimus, siekdamas išlaikyti geriausią vaizdo ir teksto kokybę. Tu visada sieki kokybiškų nuotraukų ir vaizdų, atsižvelgiant į detalumą ir estetiką. Tavo tikslas – pateikti įkvepiančius ir estetiškai harmoningus rezultatus, pritaikomus literatūrai, žaidimų dizainui, audiovizualiniams projektams ir kūrybinei saviraiškai.' },
              { role: 'user', content: message }
            ],
            model: 'openai', // Pollinations.AI default model
            seed: Math.floor(Math.random() * 100000),
            jsonMode: false
          }),
        });

        if (!response.ok) {
          throw new Error('Nepavyko susisiekti su AI paslauga.');
        }

        const data = await response.json();
        if (data.choices && data.choices.length > 0 && data.choices[0].message) {
          const assistantMessageContent = data.choices[0].message.content;
          appendMessage('assistant', assistantMessageContent);
        } else {
          throw new Error('Neteisingas AI atsakymas.');
        }
      } catch (error) {
        console.error(error);
        appendMessage('assistant', 'Klaida bendraujant su Hexacola. Bandykite dar kartą.');
      }
    }

    // Append Message to Chat
    function appendMessage(role, content) {
      const chat = document.getElementById('chat');
      const messageDiv = document.createElement('div');
      messageDiv.classList.add('chat-message', role);
      messageDiv.textContent = content;
      chat.appendChild(messageDiv);
      chat.scrollTop = chat.scrollHeight;
    }

    // Save Image to localStorage
    function saveImage(url, prompt, model, width, height, seed, mimeType) {
      let images = JSON.parse(localStorage.getItem('generatedImages')) || [];
      images.push({ url, prompt, model, width, height, seed, mimeType });
      localStorage.setItem('generatedImages', JSON.stringify(images));
    }

    // Load Generated Images
    function loadGeneratedImages() {
      let images = JSON.parse(localStorage.getItem('generatedImages')) || [];
      images.forEach(image => {
        addImageToGallery(image.url, image.prompt, image.model, image.width, image.height, image.seed, image.mimeType);
      });
    }

    // Add Image to Gallery
    function addImageToGallery(url, prompt, model, width, height, seed, mimeType) {
      const generatedImageDiv = document.getElementById('generatedImage');
      const imageContainer = document.createElement('div');
      imageContainer.classList.add('image-container');

      const imgElement = document.createElement('img');
      imgElement.src = url;
      imgElement.alt = 'Sugeneruotas vaizdas';
      imgElement.title = 'Spauskite norėdami padidinti';
      imgElement.dataset.type = mimeType; // Store MIME type for correct file extension
      imageContainer.appendChild(imgElement);

      // Add caption
      const caption = document.createElement('div');
      caption.classList.add('caption');
      caption.innerHTML = `
        <strong>Prompt:</strong> ${prompt}<br>
        <strong>Model:</strong> ${model}<br>
        <strong>Dimensions:</strong> ${width}px x ${height}px<br>
        <strong>Seed:</strong> ${seed}
      `;
      imageContainer.appendChild(caption);

      // Add download options
      const downloadOptions = document.createElement('div');
      downloadOptions.classList.add('download-options');

      const formatSelect = document.createElement('select');
      formatSelect.innerHTML = `
        <option value="png">PNG</option>
        <option value="jpg">JPG</option>
        <option value="webp">WEBP</option>
      `;
      downloadOptions.appendChild(formatSelect);

      const downloadBtn = document.createElement('button');
      downloadBtn.innerHTML = '<i class="fas fa-download"></i> Download';
      downloadBtn.onclick = () => {
        const format = formatSelect.value;
        downloadImage(url, `hexacola_image_${seed}.${format}`, format);
      };
      downloadOptions.appendChild(downloadBtn);

      imageContainer.appendChild(downloadOptions);

      generatedImageDiv.appendChild(imageContainer);
    }

    // Add Camera Feature Description
    function showCameraFeature() {
      var feature = document.getElementById("cameraFeatures").value;
      var description = "";
      switch(feature) {
          case "360 Panorama":
              description = "A camera feature that allows capturing a full 360-degree panoramic view.";
              break;
          case "DSLR":
              description = "Digital Single-Lens Reflex cameras are known for their versatility, high image quality, and interchangeable lenses.";
              break;
          case "Electron Microscope":
              description = "A powerful imaging tool that uses electrons to achieve much higher magnifications than optical microscopes.";
              break;
          case "Macro Lens":
              description = "A lens designed for extreme close-up photography, allowing you to capture fine details of small subjects.";
              break;
          case "Magnification":
              description = "The ability of a lens to enlarge the appearance of objects, essential for detailed close-up photography.";
              break;
          case "Microscopy":
              description = "The technique of using microscopes to view small objects and organisms that are not visible to the naked eye.";
              break;
          case "Miniature Faking":
              description = "A technique that uses selective focus and perspective to make real-life scenes appear miniature.";
              break;
          case "Panorama":
              description = "A wide-angle view or representation of a physical space, capturing expansive scenes in a single image.";
              break;
          case "Pinhole Lens":
              description = "A simple lens without glass, using a tiny aperture to create images with unique depth and focus characteristics.";
              break;
          case "Satellite Imagery":
              description = "Images of Earth or other planets captured by satellites, used for mapping, weather forecasting, and more.";
              break;
          case "Super Resolution Microscopy":
              description = "Advanced microscopy techniques that surpass the diffraction limit to reveal finer details of specimens.";
              break;
          case "Telephoto Lens":
              description = "A lens with a long focal length that allows photographers to capture distant subjects with magnification.";
              break;
          case "Telescope Lens":
              description = "Optical lenses designed for telescopes to observe distant celestial objects with clarity.";
              break;
          case "Ultra Wide Angle Lens":
              description = "A lens with an extremely wide field of view, ideal for capturing expansive landscapes and architecture.";
              break;
          case "Wide Angle Lens":
              description = "A lens with a shorter focal length that captures a wider field of view than standard lenses.";
              break;
          default:
              description = "";
      }
      document.getElementById("cameraFeatureDescription").innerHTML = description;
    }

    // Add Color Description
    function showColor() {
      var color = document.getElementById("colors").value;
      var description = "";
      switch(color) {
          case "Baby Blue Color":
              description = "A soft, pale blue shade often associated with serenity and calmness.";
              break;
          case "Baby Pink Color":
              description = "A gentle, light pink hue that conveys sweetness and tenderness.";
              break;
          case "Beige":
              description = "A light brownish-yellow color that is neutral and versatile.";
              break;
          case "Blue":
              description = "A primary color representing trust, loyalty, and wisdom.";
              break;
          case "Brown Color":
              description = "A rich, earthy tone that symbolizes stability and reliability.";
              break;
          case "Citrus":
              description = "A vibrant, zesty color inspired by citrus fruits, evoking energy and freshness.";
              break;
          case "Coquelicot Color":
              description = "A bright red poppy flower color, vibrant and eye-catching.";
              break;
          case "Cyan":
              description = "A greenish-blue color, often associated with clarity and calm.";
              break;
          case "CYMK":
              description = "A color model used in color printing, consisting of Cyan, Magenta, Yellow, and Key (Black).";
              break;
          case "Gold Color":
              description = "A rich, metallic yellow hue that signifies luxury and success.";
              break;
          case "Gray":
              description = "A neutral color between black and white, representing balance and sophistication.";
              break;
          case "Grayscale Color":
              description = "A range of shades of gray without any color, used in monochromatic designs.";
              break;
          case "Green":
              description = "A color that symbolizes nature, growth, and harmony.";
              break;
          case "Hot Pink Color":
              description = "A vivid pink shade that is bold and energetic.";
              break;
          case "Indigo":
              description = "A deep blue-purple color, often associated with intuition and perception.";
              break;
          case "Lavender Color":
              description = "A light purple hue that conveys grace, elegance, and tranquility.";
              break;
          case "Magenta":
              description = "A vibrant purplish-red color that is bold and striking.";
              break;
          case "Matte Black Color":
              description = "A non-reflective black shade that exudes modernity and sleekness.";
              break;
          case "Mint Color":
              description = "A fresh, light greenish-blue color that feels cool and soothing.";
              break;
          case "Navy Blue":
              description = "A dark blue color that represents authority, trust, and professionalism.";
              break;
          case "Neon Blue Color":
              description = "A bright, electric blue shade that stands out and grabs attention.";
              break;
          case "Neon Green Color":
              description = "A luminous green hue that is bold and eye-catching.";
              break;
          case "Neon Orange Color":
              description = "A bright, fluorescent orange color that is energetic and vibrant.";
              break;
          case "Neon Purple Color":
              description = "A striking, luminous purple shade that is both bold and playful.";
              break;
          case "Neon Red Color":
              description = "A bright, fluorescent red color that is intense and attention-grabbing.";
              break;
          case "Neon Yellow Color":
              description = "A vivid, glowing yellow hue that is lively and cheerful.";
              break;
          case "Orange":
              description = "A warm, vibrant color that combines the energy of red and the happiness of yellow.";
              break;
          case "Pink":
              description = "A soft and delicate color associated with love and compassion.";
              break;
          case "Red":
              description = "A strong, passionate color that signifies energy, strength, and determination.";
              break;
          case "RGB":
              description = "A color model based on red, green, and blue light, used primarily in digital displays.";
              break;
          case "Silver Color":
              description = "A shiny, metallic gray color that symbolizes modernity and sophistication.";
              break;
          case "Teal":
              description = "A medium to deep blue-green color that is calming and refreshing.";
              break;
          case "Turquoise":
              description = "A blue-green color that evokes tropical waters and tranquility.";
              break;
          case "Vermillion":
              description = "A brilliant red or scarlet pigment that is vivid and intense.";
              break;
          case "Violet":
              description = "A deep purple color associated with creativity and luxury.";
              break;
          case "White":
              description = "A pure color representing simplicity, cleanliness, and innocence.";
              break;
          case "Yellow":
              description = "A bright and cheerful color that represents happiness and positivity.";
              break;
          default:
              description = "";
      }
      document.getElementById("colorDescription").innerHTML = description;
    }

    // Prevent Image Download and Right-Click
    function disableImageDownload() {
      const images = document.querySelectorAll('.generated-image img, .library-container img');
      images.forEach(img => {
        img.oncontextmenu = (e) => e.preventDefault();
        img.draggable = false;
      });
    }

    // Call disableImageDownload after loading images
    document.addEventListener('DOMContentLoaded', () => {
      disableImageDownload();
    });
  </script>
</body>
</html>
