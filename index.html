<!DOCTYPE html>
<html lang="lt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Hexacola AI Image Generator</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <style>
    /* Bendrieji stiliai */
    body {
      margin: 0;
      font-family: "Courier Prime", monospace;
      background-color: #1e1e1e; /* Tamsus fonas */
      color: #ffffff; /* Balta spalva tekstui */
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      transition: background-color 0.3s, color 0.3s;
    }
    body.dark-mode {
      background-color: #121212; /* Dar tamsesnis fonas */
      color: #e0e0e0;
    }
    .main-wrapper {
      display: flex;
      width: 100%;
      max-width: 1200px;
      padding: 20px;
      box-sizing: border-box;
    }
    /* Sidebar for Chat and Prompt Generators */
    .sidebar {
      flex: 1;
      max-width: 300px;
      margin-right: 20px;
      background-color: rgba(30, 30, 30, 0.95);
      border: 2px solid #444;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.7);
      transition: background-color 0.3s, border-color 0.3s;
      display: flex;
      flex-direction: column;
      height: fit-content;
    }
    body.dark-mode .sidebar {
      background-color: rgba(18, 18, 18, 0.95);
      border-color: #666;
    }
    .sidebar h2 {
      margin-top: 0;
      color: #00ffcc;
      text-shadow: 0 0 5px rgba(0, 255, 204, 0.5);
    }
    .sidebar .input-group {
      margin-bottom: 20px;
      text-align: left;
    }
    .sidebar .input-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #00ffcc;
      text-shadow: 0 0 5px rgba(0, 255, 204, 0.5);
    }
    .sidebar .input-group button {
      width: 100%;
      padding: 10px;
      font-size: 1em;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s, transform 0.2s;
      color: #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    }
    .sidebar .input-group button.generate-prompt {
      background-color: #00ffcc;
    }
    .sidebar .input-group button.generate-prompt:hover {
      background-color: #00e6b3;
      transform: translateY(-2px);
    }
    
    /* Chat Area */
    .chat {
      flex: 1;
      display: flex;
      flex-direction: column;
      height: 300px;
      background-color: rgba(18, 18, 18, 0.95);
      border: 2px solid #666;
      border-radius: 15px;
      padding: 15px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.7);
      overflow-y: auto;
      margin-bottom: 20px;
      max-height: 400px;
    }
    .chat-message {
      margin-bottom: 15px;
      padding: 10px;
      border-radius: 8px;
      background-color: #333333;
      color: #ffffff;
      word-wrap: break-word;
      white-space: pre-wrap;
    }
    .chat-message.user {
      background-color: #00b3a4;
      align-self: flex-end;
    }
    .chat-message.assistant {
      background-color: #555555;
      align-self: flex-start;
    }
    .chat-input-group {
      display: flex;
      gap: 10px;
    }
    .chat-input-group input {
      flex: 1;
      padding: 10px;
      border: 2px solid #00ffcc;
      border-radius: 8px;
      background-color: #2c2c2c;
      color: #ffffff;
      transition: background-color 0.3s, border-color 0.3s;
      box-shadow: inset 0 0 10px rgba(0, 255, 204, 0.1);
    }
    body.dark-mode .chat-input-group input {
      background-color: #1e1e1e;
      border-color: #00b3a4;
      color: #e0e0e0;
    }
    .chat-input-group button {
      padding: 10px 15px;
      font-size: 1em;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s, transform 0.2s;
      color: #ffffff;
      background-color: #00ffcc;
      display: flex;
      align-items: center;
      gap: 5px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    }
    .chat-input-group button:hover {
      background-color: #00e6b3;
      transform: translateY(-2px);
    }
    
    /* Main Container for Image Generation */
    .container {
      flex: 2;
      background-color: rgba(30, 30, 30, 0.95); /* Tamsus puslapio fonas */
      border: 2px solid #444;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.7);
      transition: background-color 0.3s, border-color 0.3s;
      position: relative;
    }
    body.dark-mode .container {
      background-color: rgba(18, 18, 18, 0.95);
      border-color: #666;
    }
    .header {
      margin-bottom: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .header h1 {
      font-size: 2.5em;
      margin: 0;
      color: #00ffcc; /* Ryškus antraštės tekstas */
      text-shadow: 0 0 10px rgba(0, 255, 204, 0.7);
    }
    .input-group {
      display: flex;
      flex-direction: column;
      margin-bottom: 25px;
      text-align: left;
      position: relative;
    }
    .input-group label {
      margin-bottom: 8px;
      font-weight: bold;
      color: #00ffcc;
      text-shadow: 0 0 5px rgba(0, 255, 204, 0.5);
    }
    .input-group textarea, .input-group select {
      padding: 12px;
      border: 2px solid #00ffcc;
      border-radius: 8px;
      resize: vertical;
      font-size: 1em;
      background-color: #2c2c2c;
      color: #ffffff;
      transition: background-color 0.3s, border-color 0.3s;
      box-shadow: inset 0 0 10px rgba(0, 255, 204, 0.1);
    }
    body.dark-mode .input-group textarea,
    body.dark-mode .input-group select {
      background-color: #1e1e1e;
      border-color: #00b3a4;
      color: #e0e0e0;
    }
    /* Stilizacijos naujajai personažo aprašymo funkcijai */
    .input-group button#addCharacterBtn {
      margin-top: 10px;
      padding: 5px 10px;
      font-size: 1.2em;
      background-color: #00ffcc;
      color: #000;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s;
      width: 40px;
      height: 40px;
      position: absolute;
      right: 0;
      top: 0;
    }
    .input-group button#addCharacterBtn:hover {
      background-color: #00e6b3;
    }
    .additional-character-group button {
      margin-top: 10px;
      padding: 5px 10px;
      font-size: 1em;
      background-color: #ff4d4d;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    .additional-character-group button:hover {
      background-color: #e60000;
    }
    .options {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      margin-bottom: 25px;
      text-align: left;
    }
    .options .option {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      margin-bottom: 15px;
      width: 48%;
    }
    .options .option label {
      margin-bottom: 8px;
      font-weight: bold;
      color: #00ffcc;
      text-shadow: 0 0 5px rgba(0, 255, 204, 0.5);
    }
    .options .option input,
    .options .option select {
      padding: 8px;
      border: 2px solid #00ffcc;
      border-radius: 8px;
      font-size: 1em;
      background-color: #333333;
      color: #ffffff;
      transition: background-color 0.3s, border-color 0.3s;
      width: 100%;
      box-shadow: inset 0 0 10px rgba(0, 255, 204, 0.1);
    }
    body.dark-mode .options .option input,
    body.dark-mode .options .option select {
      background-color: #1e1e1e;
      border-color: #00b3a4;
      color: #e0e0e0;
    }
    .buttons {
      display: flex;
      justify-content: center;
      gap: 25px;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }
    .buttons button {
      padding: 12px 25px;
      font-size: 1.1em;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s, transform 0.2s;
      color: #ffffff;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    }
    .buttons button.generate {
      background-color: #00ffcc;
    }
    .buttons button.generate:hover {
      background-color: #00e6b3;
      transform: translateY(-2px);
    }
    .buttons button.dark-mode-toggle {
      background-color: #555555;
    }
    .buttons button.dark-mode-toggle:hover {
      background-color: #777777;
      transform: translateY(-2px);
    }
    .buttons button.auto-toggle {
      background-color: #ffcc00;
      color: #000000;
      position: relative;
    }
    .buttons button.auto-toggle.active {
      background-color: #ffaa00;
    }
    .buttons button.auto-toggle:hover {
      background-color: #ffaa00;
      transform: translateY(-2px);
    }
    .buttons button.auto-toggle::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 125%; /* Rodoma virš mygtuko */
      left: 50%;
      transform: translateX(-50%);
      background-color: #333;
      color: #fff;
      padding: 5px 10px;
      border-radius: 5px;
      white-space: nowrap;
      opacity: 0;
      transition: opacity 0.3s;
      pointer-events: none;
      font-size: 0.9em;
      z-index: 1;
    }
    .buttons button.auto-toggle:hover::after {
      opacity: 1;
    }
    .buttons button.download {
      background-color: #ff5722;
    }
    .buttons button.download:hover {
      background-color: #e64a19;
      transform: translateY(-2px);
    }
    .generated-image {
      margin-top: 25px;
      position: relative;
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
    }
    .image-container {
      position: relative;
      width: 200px;
      /* Fiksuotas plotis, kad būtų matomi keli vaizdai */
    }
    .image-container img {
      width: 100%;
      height: auto;
      border: 2px solid #00ffcc;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 0.3s, box-shadow 0.3s;
      display: block;
    }
    .image-container img:hover {
      transform: scale(1.05);
      box-shadow: 0 0 20px rgba(0, 255, 204, 0.7);
    }
    /* Teksto aprašymas ant nuotraukos */
    .caption {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      background: rgba(0, 0, 0, 0.6);
      color: #ffffff;
      padding: 10px;
      box-sizing: border-box;
      border-bottom-left-radius: 10px;
      border-bottom-right-radius: 10px;
      font-size: 0.9em;
      opacity: 0;
      transition: opacity 0.3s;
      max-height: 50%;
      overflow: auto;
      text-align: left;
    }
    .image-container:hover .caption {
      opacity: 1;
    }
    /* Laikmatis / Įkrovimo indikatorius */
    .loader {
      border: 8px solid #f3f3f3; /* Šviesus fonas */
      border-top: 8px solid #00ffcc; /* Ryškus spalvos viršutinis žiedas */
      border-radius: 50%;
      width: 60px;
      height: 60px;
      animation: spin 1s linear infinite;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 10;
    }
    .overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(30, 30, 30, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 15px;
      z-index: 9;
      display: none; /* Pradžioje nematomas */
      flex-direction: column;
      gap: 15px;
    }
    @keyframes spin {
      0% { transform: rotate(0deg) translate(-50%, -50%); }
      100% { transform: rotate(360deg) translate(-50%, -50%); }
    }
    footer {
      margin-top: 40px;
      font-size: 0.8em;
      color: #aaaaaa;
    }
    footer a {
      color: #00ffcc;
      text-decoration: none;
      font-weight: bold;
    }
    footer a:hover {
      text-decoration: underline;
    }
    @media (max-width: 900px) {
      .main-wrapper {
        flex-direction: column;
        align-items: center;
      }
      .sidebar {
        max-width: none;
        margin-right: 0;
        margin-bottom: 20px;
        width: 100%;
      }
      .container {
        width: 100%;
      }
    }
    @media (max-width: 600px) {
      .options .option {
        width: 100%;
      }
      .buttons {
        flex-direction: column;
        gap: 15px;
      }
      .loader {
        width: 40px;
        height: 40px;
        border-width: 6px;
      }
      .image-container {
        width: 100%;
      }
      .caption {
        font-size: 0.8em;
        padding: 8px;
      }
    }
    /* Modal Stiliai */
    .modal {
      display: none; /* Pradžioje nematomas */
      position: fixed;
      z-index: 100;
      padding-top: 60px;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.9);
    }
    .modal-content {
      margin: auto;
      display: block;
      width: 80%;
      max-width: 1000px;
    }
    .modal-content, #caption {  
      animation-name: zoom;
      animation-duration: 0.6s;
    }
    @keyframes zoom {
      from {transform:scale(0)} 
      to {transform:scale(1)}
    }
    .close {
      position: absolute;
      top: 30px;
      right: 45px;
      color: #ffffff;
      font-size: 40px;
      font-weight: bold;
      transition: color 0.3s;
      cursor: pointer;
    }
    .close:hover,
    .close:focus {
      color: #00ffcc;
      text-decoration: none;
      cursor: pointer;
    }
    @media only screen and (max-width: 700px){
      .modal-content {
        width: 100%;
      }
      .close {
        top: 15px;
        right: 35px;
        font-size: 30px;
      }
    }
  </style>
</head>
<body>
  <div class="main-wrapper">
    <!-- Sidebar for Chat and Prompt Generators -->
    <div class="sidebar">
      <h2>AI Prompt Generator</h2>
      <div class="input-group">
        <label>Generuoti Aprašymą:</label>
        <button class="generate-prompt" onclick="generateRandomPrompt('background')"><i class="fas fa-lightbulb"></i> GENERUOTI Į FONĄ</button>
        <button class="generate-prompt" onclick="generateRandomPrompt('character')"><i class="fas fa-lightbulb"></i> GENERUOTI Į PERSONAŽĄ</button>
      </div>
      <!-- Chat Interface -->
      <h2>Hexacola Chat</h2>
      <div class="chat" id="chat">
        <!-- Chat messages will appear here -->
      </div>
      <div class="chat-input-group">
        <input type="text" id="chatInput" placeholder="Rašykite žinutę..." />
        <button onclick="sendMessage()"><i class="fas fa-paper-plane"></i> Siųsti</button>
      </div>
    </div>

    <!-- Main Container for Image Generation -->
    <div class="container">
      <div class="header">
        <h1>Hexacola AI Image Generator</h1>
      </div>
      <div class="input-group">
        <label for="backgroundPrompt">Background Description:</label>
        <textarea id="backgroundPrompt" placeholder="Pvz., Saulėlydis kalnuose, ramus ežeras..."></textarea>
      </div>
      <div class="input-group">
        <label for="characterPrompt">Character Description:</label>
        <textarea id="characterPrompt" placeholder="Pvz., Jaunas riteris su sidabru kruopelė..."></textarea>
        <button type="button" id="addCharacterBtn" onclick="addCharacterDescription()" title="Pridėti papildomą personažo aprašymą">+</button>
      </div>
      <div id="additionalCharacterDescriptions"></div>
      <div class="input-group">
        <label for="negativePrompt">Negative Prompt:</label>
        <textarea id="negativePrompt" placeholder="Nenoriu logotipo, iškraipyto stiliaus..." readonly></textarea>
      </div>
      <div class="options">
        <div class="option">
          <label for="model">Modelis:</label>
          <select id="model">
            <option value="flux" selected>Flux</option>
            <option value="flux-anime">Flux-Anime</option>
            <option value="flux-3d">Flux-3D</option>
            <option value="flux-pro">Flux-Pro</option>
            <option value="flux-realism">Flux-Realism</option>
            <option value="flux-cablyal">Flux-CablyAl</option>
            <option value="any-dark">Any-Dark</option>
            <option value="turbo">Turbo</option>
            <option value="Unity">Unity</option>
          </select>
        </div>
        <div class="option">
          <label for="width">Plotis (px):</label>
          <input type="number" id="width" value="512" min="64" max="2048" />
        </div>
        <div class="option">
          <label for="height">Aukštis (px):</label>
          <input type="number" id="height" value="512" min="64" max="2048" />
        </div>
        <div class="option">
          <label for="seed">Seed:</label>
          <input type="number" id="seed" placeholder="Palikite tuščią..." />
        </div>
        <div class="option">
          <label for="imageOptions">Kiek paveikslėlių:</label>
          <input type="number" id="imageOptions" value="1" min="1" max="10" />
        </div>
        <div class="option">
          <label for="style">Stilius:</label>
          <select id="style">
            <option value="None">None</option>
            <option value="Cinematic">Cinematic</option>
            <option value="Pixel Art">Pixel Art</option>
            <option value="Anime">Anime</option>
            <option value="Realistic">Realistic</option>
            <option value="Mix">Mix</option>
            <option value="Storyboard">Storyboard</option>
            <option value="Film Noir">Film Noir</option>
            <option value="Vintage">Vintage</option>
            <option value="Modern">Modern</option>
          </select>
        </div>
      </div>
      <div class="buttons">
        <button class="generate" onclick="generateImage()"><i class="fas fa-magic"></i> GENERUOTI</button>
        <button class="auto-toggle" onclick="toggleAutoMode()" id="autoToggleBtn" data-tooltip="Automatiškai optimizuoja aprašymus naudojant AI"><i class="fas fa-robot"></i> AUTO OFF</button>
        <button class="dark-mode-toggle" onclick="toggleDarkMode()"><i class="fas fa-moon"></i> 🌙</button>
        <button class="download" onclick="downloadAllImages()" hidden><i class="fas fa-download"></i> ATSISIŲSTI VISKĄ</button>
      </div>
      <div class="generated-image" id="generatedImage"></div>
      <!-- Įkrovimo indikatorius -->
      <div class="overlay" id="overlay">
        <div class="loader"></div>
        <div id="timer">Generuojama: 0s</div>
      </div>
    </div>
  </div>
  
  <!-- Modal for Fullscreen Image -->
  <div id="imageModal" class="modal">
    <span class="close">&times;</span>
    <img class="modal-content" id="modalImage">
  </div>

  <footer>
    <p>
      API dokumentacija:
      <a href="https://github.com/pollinations/pollinations/blob/master/APIDOCS.md" target="_blank">Pollinations.AI GitHub</a>
    </p>
    <p>
      Sukurta su ❤️ naudojant
      <a href="https://pollinations.ai/" target="_blank">Pollinations.AI</a>.
    </p>
  </footer>

  <script>
    let timerInterval;
    let autoMode = false;

    // Išsaugoti nustatymus vietiniame saugykloje
    function saveSettings() {
      const backgroundPrompt = document.getElementById('backgroundPrompt').value;
      const characterPrompt = document.getElementById('characterPrompt').value;
      const negativePrompt = document.getElementById('negativePrompt').value;
      const model = document.getElementById('model').value;
      const width = document.getElementById('width').value;
      const height = document.getElementById('height').value;
      const seed = document.getElementById('seed').value;
      const imageOptions = document.getElementById('imageOptions').value;
      const style = document.getElementById('style').value;

      // Rinkti papildomus personažo aprašymus
      const additionalCharacterDescriptions = [];
      const additionalGroups = document.querySelectorAll('.additional-character-group textarea');
      additionalGroups.forEach(textarea => {
        const desc = textarea.value.trim();
        if (desc) {
          additionalCharacterDescriptions.push(desc);
        }
      });

      localStorage.setItem('backgroundPrompt', backgroundPrompt);
      localStorage.setItem('characterPrompt', characterPrompt);
      localStorage.setItem('negativePrompt', negativePrompt);
      localStorage.setItem('model', model);
      localStorage.setItem('width', width);
      localStorage.setItem('height', height);
      localStorage.setItem('seed', seed);
      localStorage.setItem('imageOptions', imageOptions);
      localStorage.setItem('style', style);
      localStorage.setItem('autoMode', autoMode);
      localStorage.setItem('additionalCharacterDescriptions', JSON.stringify(additionalCharacterDescriptions));
    }

    // Įkelti nustatymus iš vietinės saugyklos
    function loadSettings() {
      const backgroundPrompt = localStorage.getItem('backgroundPrompt');
      const characterPrompt = localStorage.getItem('characterPrompt');
      const negativePrompt = localStorage.getItem('negativePrompt');
      const model = localStorage.getItem('model');
      const width = localStorage.getItem('width');
      const height = localStorage.getItem('height');
      const seed = localStorage.getItem('seed');
      const imageOptions = localStorage.getItem('imageOptions');
      const style = localStorage.getItem('style');
      const savedAutoMode = localStorage.getItem('autoMode');
      const additionalCharacterDescriptions = JSON.parse(localStorage.getItem('additionalCharacterDescriptions') || '[]');

      if (backgroundPrompt) document.getElementById('backgroundPrompt').value = backgroundPrompt;
      if (characterPrompt) document.getElementById('characterPrompt').value = characterPrompt;
      if (negativePrompt) document.getElementById('negativePrompt').value = negativePrompt;
      if (model) document.getElementById('model').value = model;
      if (width) document.getElementById('width').value = width;
      if (height) document.getElementById('height').value = height;
      if (seed) document.getElementById('seed').value = seed;
      if (imageOptions) document.getElementById('imageOptions').value = imageOptions;
      if (style) document.getElementById('style').value = style;
      if (savedAutoMode === 'true') {
        autoMode = true;
        document.getElementById('autoToggleBtn').classList.add('active');
        document.getElementById('autoToggleBtn').innerHTML = '<i class="fas fa-robot"></i> AUTO ON';
      } else {
        autoMode = false;
        document.getElementById('autoToggleBtn').classList.remove('active');
        document.getElementById('autoToggleBtn').innerHTML = '<i class="fas fa-robot"></i> AUTO OFF';
      }

      // Įkelti papildomus personažo aprašymus
      additionalCharacterDescriptions.forEach(desc => {
        addCharacterDescription(desc);
      });
    }

    // Pradinis įkėlimas
    document.addEventListener('DOMContentLoaded', () => {
      loadSettings();
      loadDarkMode();
      setupModal();
      initializeNegativePrompt();
    });

    // Inicializuoti Negative Prompt su numatytuoju tekstu
    function initializeNegativePrompt() {
      const negativePrompt = document.getElementById('negativePrompt');
      if (!negativePrompt.value) {
        negativePrompt.value = "low quality, blurry, bad anatomy, out of focus, noise, duplicate, watermark, text, ugly, messy";
      }
    }

    // Tamsusis režimas
    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
      const toggleBtn = document.querySelector('.dark-mode-toggle');
      if (document.body.classList.contains('dark-mode')) {
        toggleBtn.innerHTML = '<i class="fas fa-sun"></i> ☀️';
      } else {
        toggleBtn.innerHTML = '<i class="fas fa-moon"></i> 🌙';
      }
      localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
    }

    // Įkelti tamsaus režimo nustatymus
    function loadDarkMode() {
      const darkMode = localStorage.getItem('darkMode');
      if (darkMode === 'true') {
        document.body.classList.add('dark-mode');
        document.querySelector('.dark-mode-toggle').innerHTML = '<i class="fas fa-sun"></i> ☀️';
      } else {
        document.querySelector('.dark-mode-toggle').innerHTML = '<i class="fas fa-moon"></i> 🌙';
      }
    }

    // Pridėti „AUTO“ režimo toggle funkciją
    function toggleAutoMode() {
      autoMode = !autoMode;
      const toggleBtn = document.getElementById('autoToggleBtn');
      if (autoMode) {
        toggleBtn.classList.add('active');
        toggleBtn.innerHTML = '<i class="fas fa-robot"></i> AUTO ON';
      } else {
        toggleBtn.classList.remove('active');
        toggleBtn.innerHTML = '<i class="fas fa-robot"></i> AUTO OFF';
      }
      localStorage.setItem('autoMode', autoMode);
    }

    // Funkcija, kuri prideda stiliaus aprašymą į promptą
    function appendStyleToPrompt(prompt, style) {
      switch(style) {
        case 'Cinematic':
          return `${prompt}, cinematic, anamorphic lens, highly cinematic color palette, detailed lighting and shadows`;
        case 'Pixel Art':
          return `${prompt}, in high-quality pixel art style reminiscent of Final Fantasy, vibrant colors, and detailed pixelation`;
        case 'Anime':
          return `${prompt}, in anime style reminiscent of Attack on Titan and Demon Slayer, vibrant colors, dynamic poses, and detailed character expressions`;
        case 'Realistic':
          return `${prompt}, in realistic style, high detail, natural lighting, and lifelike textures`;
        case 'Storyboard':
          return `${prompt}, in black and white storyboard style, frame-by-frame, suitable for film creation, focusing on composition, perspective, and camera angles`;
        case 'Film Noir':
          return `${prompt}, in film noir style, high contrast, dramatic lighting, and moody atmosphere`;
        case 'Vintage':
          return `${prompt}, in vintage style, muted colors, and classic composition`;
        case 'Modern':
          return `${prompt}, in modern style, clean lines, and contemporary composition`;
        case 'Mix':
          return appendMixStyleToPrompt(prompt);
        default:
          return prompt; // "None" arba kiti nenumatyti stiliai
      }
    }

    // Funkcija, kuri parenka atsitiktinius du stilius Mix režimui
    function getRandomStyles() {
      const styles = ['Cinematic', 'Pixel Art', 'Anime', 'Realistic', 'Storyboard', 'Film Noir', 'Vintage', 'Modern'];
      let first = styles[Math.floor(Math.random() * styles.length)];
      let second = styles[Math.floor(Math.random() * styles.length)];
      while (second === first) {
        second = styles[Math.floor(Math.random() * styles.length)];
      }
      return `${first} and ${second}`;
    }

    // Funkcija, kuri prideda stiliaus aprašymą Mix režimui
    function appendMixStyleToPrompt(prompt) {
      const randomStyles = getRandomStyles();
      return `${prompt}, in ${randomStyles} styles, combining elements from both styles for a unique and engaging image`;
    }

    // Modal konfigūracija
    function setupModal() {
      const modal = document.getElementById("imageModal");
      const modalImg = document.getElementById("modalImage");
      const closeBtn = document.getElementsByClassName("close")[0];

      // Uždaryti modalą
      closeBtn.onclick = function() { 
        modal.style.display = "none";
      }

      // Uždaryti modalą, jei paspaudžiama bet kur kitur
      window.onclick = function(event) {
        if (event.target == modal) {
          modal.style.display = "none";
        }
      }

      // Atidaryti modalą, kai spustelėta ant vaizdo
      document.getElementById('generatedImage').addEventListener('click', function(event) {
        if(event.target.tagName === 'IMG') {
          modal.style.display = "block";
          modalImg.src = event.target.src;
        }
      });
    }

    // Function to add an additional character description
    function addCharacterDescription(description = '') {
      const container = document.getElementById('additionalCharacterDescriptions');
      
      const descriptionCount = container.children.length;
      if (descriptionCount >= 5) { // Limit to, say, 5 additional descriptions
        alert('Galite pridėti iki 5 papildomų personažo aprašymų.');
        return;
      }

      const newGroup = document.createElement('div');
      newGroup.classList.add('input-group', 'additional-character-group');

      const label = document.createElement('label');
      label.textContent = `Additional Character Description ${descriptionCount + 1}:`;
      label.setAttribute('for', `additionalCharacterPrompt${descriptionCount + 1}`);

      const textarea = document.createElement('textarea');
      textarea.id = `additionalCharacterPrompt${descriptionCount + 1}`;
      textarea.placeholder = 'Pvz., ilgasis šaknys, puikiai sutvarkyta šviesa...';
      textarea.value = description;

      const removeBtn = document.createElement('button');
      removeBtn.type = 'button';
      removeBtn.textContent = '–'; // Remove button
      removeBtn.title = 'Pašalinti šį aprašymą';
      removeBtn.onclick = () => {
        container.removeChild(newGroup);
        saveSettings(); // Save changes
      };

      newGroup.appendChild(label);
      newGroup.appendChild(textarea);
      newGroup.appendChild(removeBtn);

      container.appendChild(newGroup);
    }

    // Generuoti vaizdą
    async function generateImage() {
      const generateButton = document.querySelector('.generate');
      generateButton.disabled = true; // Išjungti mygtuką generavimo metu

      const backgroundPrompt = document.getElementById('backgroundPrompt').value.trim();
      const characterPrompt = document.getElementById('characterPrompt').value.trim();
      const rawNegativePrompt = document.getElementById('negativePrompt').value.trim();
      const model = document.getElementById('model').value;
      const width = document.getElementById('width').value;
      const height = document.getElementById('height').value;
      const seed = document.getElementById('seed').value;
      const imageOptions = parseInt(document.getElementById('imageOptions').value);
      const style = document.getElementById('style').value;

      // Rinkti papildomus personažo aprašymus
      const additionalCharacterDescriptions = [];
      const additionalGroups = document.querySelectorAll('.additional-character-group textarea');
      additionalGroups.forEach(textarea => {
        const desc = textarea.value.trim();
        if (desc) {
          additionalCharacterDescriptions.push(desc);
        }
      });

      // Patikrinti, ar nėra jokių aprašymų
      const noPrompts = !backgroundPrompt && !characterPrompt && additionalCharacterDescriptions.length === 0;

      let backgroundCombinedPrompt = '';
      let characterCombinedPrompt = '';

      if (noPrompts) {
        // Jei nėra jokių aprašymų, generuoti tiek background, tiek character
        try {
          backgroundCombinedPrompt = await generateRandomPromptFunction('background', style);
          characterCombinedPrompt = await generateRandomPromptFunction('character', style);
          // Priskirti sugeneruotus aprašymus
          document.getElementById('backgroundPrompt').value = backgroundCombinedPrompt;
          document.getElementById('characterPrompt').value = characterCombinedPrompt;
        } catch (error) {
          console.error(error);
          alert('Nepavyko sugeneruoti atsitiktinio aprašymo. Bandykite dar kartą.');
          generateButton.disabled = false;
          return;
        }
      } else {
        // Jei yra bent vienas aprašymas, užtikrinti, kad jis atitinka tik background arba character
        if (backgroundPrompt) {
          backgroundCombinedPrompt = backgroundPrompt;
        }
        if (characterPrompt) {
          characterCombinedPrompt = characterPrompt;
        }
      }

      // Patikrinkite, ar yra bent vienas aprašymas
      if ((!backgroundCombinedPrompt && !characterCombinedPrompt)) {
        alert('Prašome įvesti bent vieną fono arba personažo aprašymą.');
        generateButton.disabled = false;
        return;
      }

      saveSettings();

      let optimizedBackgroundPrompt = backgroundCombinedPrompt;
      let optimizedCharacterPrompt = characterCombinedPrompt;
      let optimizedNegativePrompt = "low quality, blurry, bad anatomy, out of focus, noise, duplicate, watermark, text, ugly, messy, " + rawNegativePrompt;

      if (autoMode) {
        try {
          // Optimize background prompt with style
          if (backgroundCombinedPrompt) {
            optimizedBackgroundPrompt = await optimizePrompt(`Optimize the following background prompt for high-quality image generation in ${style} style: "${backgroundCombinedPrompt}"`);
          }

          // Optimize character prompt with style
          if (characterCombinedPrompt) {
            optimizedCharacterPrompt = await optimizePrompt(`Optimize the following character prompt for high-quality image generation in ${style} style: "${characterCombinedPrompt}"`);
          }

          // Optimize each additional character description with style
          for (let i = 0; i < additionalCharacterDescriptions.length; i++) {
            additionalCharacterDescriptions[i] = await optimizePrompt(`Optimize the following character description to match the ${style} style: "${additionalCharacterDescriptions[i]}"`);
          }

          // Optimize negative prompt
          if (rawNegativePrompt) {
            optimizedNegativePrompt = "low quality, blurry, bad anatomy, out of focus, noise, duplicate, watermark, text, ugly, messy, " + await optimizePrompt(`Optimize the following negative prompt to exclude unwanted elements: "${rawNegativePrompt}"`);
          }
        } catch (error) {
          console.error(error);
          alert('Klaida optimizuojant aprašymus su AI. Bandykite dar kartą.');
          generateButton.disabled = false;
          return;
        }
      }

      // Integruoti papildomus personažo aprašymus
      let fullCharacterPrompt = optimizedCharacterPrompt;
      if (additionalCharacterDescriptions.length > 0) {
        fullCharacterPrompt += ' ' + additionalCharacterDescriptions.join(' ');
        // Pridėti instrukcijas išlaikyti stiliaus nuoseklumą
        fullCharacterPrompt += ' Ensure that all characters maintain the same style, face structure, and clothing as described above.';
      }

      // Pridėti aukštos kokybės vaizdo aprašymus
      let combinedPrompt = '';
      if (optimizedBackgroundPrompt && optimizedCharacterPrompt) {
        combinedPrompt = `${optimizedBackgroundPrompt}, ${fullCharacterPrompt}, with correct proportions, good perspective, and excellent composition.`;
      } else if (optimizedBackgroundPrompt) {
        combinedPrompt = `${optimizedBackgroundPrompt}, with correct proportions, good perspective, and excellent composition.`;
      } else if (optimizedCharacterPrompt) {
        combinedPrompt = `${fullCharacterPrompt}, with correct proportions, good perspective, and excellent composition.`;
      }

      if (style === 'Mix') {
        combinedPrompt = appendMixStyleToPrompt(combinedPrompt);
      } else if (style !== 'None') {
        combinedPrompt = appendStyleToPrompt(combinedPrompt, style);
      }

      // Pradėti kurti API URL
      let urlBase = `https://image.pollinations.ai/prompt/${encodeURIComponent(combinedPrompt)}?model=${encodeURIComponent(model)}&width=${encodeURIComponent(width)}&height=${encodeURIComponent(height)}&nologo=true`;

      if (rawNegativePrompt) {
        urlBase += `&negative=${encodeURIComponent(optimizedNegativePrompt)}`;
      }

      try {
        // Rodyti įkrovimo indikatorių ir pradėti laikmatį
        const overlay = document.getElementById('overlay');
        const timer = document.getElementById('timer');
        overlay.style.display = 'flex';
        let seconds = 0;
        timer.textContent = `Generuojama: ${seconds}s`;
        timerInterval = setInterval(() => {
          seconds++;
          timer.textContent = `Generuojama: ${seconds}s`;
        }, 1000);

        // Išvalyti anksčiau sugeneruotus vaizdus
        const generatedImageDiv = document.getElementById('generatedImage');
        generatedImageDiv.innerHTML = ''; // Užkrauti prieš pradedant generuoti naujus vaizdus

        const downloadButton = document.querySelector('.download');
        downloadButton.hidden = true;

        // Generuoti vaizdus
        const promises = [];
        for (let i = 0; i < imageOptions; i++) {
          let uniqueSeed;
          if (seed) {
            uniqueSeed = parseInt(seed) + i; // Pridėti skaičių prie pagrindinio seed
          } else {
            uniqueSeed = Math.floor(Math.random() * 100000); // Atsitiktinis seed
          }
          const url = `${urlBase}&seed=${encodeURIComponent(uniqueSeed)}`;
          promises.push(fetch(url).then(response => {
            if (!response.ok) {
              throw new Error('Nepavyko sugeneruoti vaizdo.');
            }
            return response.blob();
          }));
        }

        const blobs = await Promise.all(promises);
        blobs.forEach((blob, index) => {
          const imgUrl = URL.createObjectURL(blob);
          const imageContainer = document.createElement('div');
          imageContainer.classList.add('image-container');

          const imgElement = document.createElement('img');
          imgElement.src = imgUrl;
          imgElement.alt = 'Sugeneruotas vaizdas';
          imgElement.title = 'Spauskite norėdami padidinti';
          imageContainer.appendChild(imgElement);

          // Pridėti tekstinį aprašymą ant nuotraukos
          const caption = document.createElement('div');
          caption.classList.add('caption');
          caption.innerHTML = `
            <strong>Prompt:</strong> ${combinedPrompt}<br>
            <strong>Model:</strong> ${model}<br>
            <strong>Dimensions:</strong> ${width}px x ${height}px<br>
            <strong>Seed:</strong> ${seed ? uniqueSeed : 'Random'}
          `;
          imageContainer.appendChild(caption);

          generatedImageDiv.appendChild(imageContainer);
        });

        if (imageOptions > 1) {
          downloadButton.hidden = false;
        }
      } catch (error) {
        console.error(error);
        alert('Klaida generuojant vaizdą. Bandykite dar kartą.');
        document.getElementById('generatedImage').innerHTML = '';
      } finally {
        // Pasibaigus generavimui, paslėpti įkrovimo indikatorių ir sustabdyti laikmatį
        document.getElementById('overlay').style.display = 'none';
        clearInterval(timerInterval);
        generateButton.disabled = false;
      }
    }

    // Atsisiųsti visus vaizdus
    function downloadAllImages() {
      const images = document.querySelectorAll('.generated-image img');
      if (images.length === 0) {
        alert('Nėra vaizdų atsisiuntimui.');
        return;
      }
      images.forEach((img, index) => {
        const a = document.createElement('a');
        a.href = img.src;
        a.download = `hexacola_image_${index + 1}.png`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      });
    }

    // Function to optimize prompt using Pollinations.AI Text Generation API
    async function optimizePrompt(prompt) {
      const response = await fetch('https://text.pollinations.ai/openai', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          messages: [
            { role: 'system', content: 'Tu esi Hexacola GPT – kūrybingas ir universalus AI įrankis, skirtas generuoti aukštos kokybės promptus ir vaizdus, optimizuotus su Pollinations.AI. Tavo specializacija – kurti unikalius personažų aprašymus, įtraukiančius pasaulių fonus (backgrounds), detalizuotus scenarijus ir stilingus vaizdinius aprašymus, kurie puikiai dera su Pollinations.AI vaizdų generavimo galimybėmis. Tu atsižvelgi į stilistiką, spalvų paletę, kompoziciją ir vartotojo pageidavimus, siekdamas išlaikyti geriausią vaizdo ir teksto kokybę. Tu visada sieki kokybiškų nuotraukų ir vaizdų, atsižvelgdamas į detalumą ir estetiką. Tavo tikslas – pateikti įkvepiančius ir estetiškai harmoningus rezultatus, pritaikomus literatūrai, žaidimų dizainui, audiovizualiniams projektams ir kūrybinei saviraiškai.' },
            { role: 'user', content: prompt }
          ],
          model: 'openai', // Pollinations.AI default model
          seed: Math.floor(Math.random() * 100000),
          jsonMode: false
        }),
      });

      if (!response.ok) {
        throw new Error('Nepavyko susisiekti su AI paslauga.');
      }

      const data = await response.json();
      if (data.choices && data.choices.length > 0 && data.choices[0].message) {
        const optimizedPrompt = data.choices[0].message.content;
        return optimizedPrompt.trim();
      } else {
        throw new Error('Neteisingas AI atsakymas.');
      }
    }

    // Function to generate a random prompt using Pollinations.AI Text Generation API
    async function generateRandomPromptFunction(target, style) {
      let basePrompt = '';
      if (target === 'background') {
        basePrompt = 'Generate a creative and detailed description for a background of an AI-generated image that is unique and visually appealing. Ensure it is suitable for a high-quality image generation with appropriate style adaptations.';
      } else if (target === 'character') {
        basePrompt = 'Generate a creative and detailed description for a character of an AI-generated image that is unique and visually appealing. Ensure it is suitable for a high-quality image generation with appropriate style adaptations.';
      } else {
        throw new Error('Invalid target for prompt generation.');
      }

      const response = await fetch('https://text.pollinations.ai/openai', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          messages: [
            { role: 'system', content: 'Tu esi Hexacola GPT – kūrybingas ir universalus AI įrankis, skirtas generuoti aukštos kokybės promptus ir vaizdus, optimizuotus su Pollinations.AI. Tavo specializacija – kurti unikalius personažų aprašymus, įtraukiančius pasaulių fonus (backgrounds), detalizuotus scenarijus ir stilingus vaizdinius aprašymus, kurie puikiai dera su Pollinations.AI vaizdų generavimo galimybėmis. Tu atsižvelgi į stilistiką, spalvų paletę, kompoziciją ir vartotojo pageidavimus, siekdamas išlaikyti geriausią vaizdo ir teksto kokybę. Tu visada sieki kokybiškų nuotraukų ir vaizdų, atsižvelgdamas į detalumą ir estetiką. Tavo tikslas – pateikti įkvepiančius ir estetiškai harmoningus rezultatus, pritaikomus literatūrai, žaidimų dizainui, audiovizualiniams projektams ir kūrybinei saviraiškai.' },
            { role: 'user', content: basePrompt }
          ],
          model: 'openai', // Pollinations.AI default model
          seed: Math.floor(Math.random() * 100000),
          jsonMode: false
        }),
      });

      if (!response.ok) {
        throw new Error('Nepavyko susisiekti su AI paslauga.');
      }

      const data = await response.json();
      if (data.choices && data.choices.length > 0 && data.choices[0].message) {
        let generatedPrompt = data.choices[0].message.content;
        generatedPrompt = generatedPrompt.trim();

        // Apply style if selected
        if (style && style !== 'None') {
          generatedPrompt = appendStyleToPrompt(generatedPrompt, style);
        }

        return generatedPrompt;
      } else {
        throw new Error('Neteisingas AI atsakymas.');
      }
    }

    // Chat Functionality
    async function sendMessage() {
      const chatInput = document.getElementById('chatInput');
      const message = chatInput.value.trim();
      if (message === '') return;

      appendMessage('user', message);
      chatInput.value = '';

      try {
        const response = await fetch('https://text.pollinations.ai/openai', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            messages: [
              { role: 'system', content: 'Tu esi Hexacola GPT – kūrybingas ir universalus AI įrankis, skirtas generuoti aukštos kokybės promptus ir vaizdus, optimizuotus su Pollinations.AI. Tavo specializacija – kurti unikalius personažų aprašymus, įtraukiančius pasaulių fonus (backgrounds), detalizuotus scenarijus ir stilingus vaizdinius aprašymus, kurie puikiai dera su Pollinations.AI vaizdų generavimo galimybėmis. Tu atsižvelgi į stilistiką, spalvų paletę, kompoziciją ir vartotojo pageidavimus, siekdamas išlaikyti geriausią vaizdo ir teksto kokybę. Tu visada sieki kokybiškų nuotraukų ir vaizdų, atsižvelgdamas į detalumą ir estetiką. Tavo tikslas – pateikti įkvepiančius ir estetiškai harmoningus rezultatus, pritaikomus literatūrai, žaidimų dizainui, audiovizualiniams projektams ir kūrybinei saviraiškai.' },
              { role: 'user', content: message }
            ],
            model: 'openai', // Pollinations.AI default model
            seed: Math.floor(Math.random() * 100000),
            jsonMode: false
          }),
        });

        if (!response.ok) {
          throw new Error('Nepavyko susisiekti su AI paslauga.');
        }

        const data = await response.json();
        if (data.choices && data.choices.length > 0 && data.choices[0].message) {
          const assistantMessageContent = data.choices[0].message.content;
          appendMessage('assistant', assistantMessageContent);
        } else {
          throw new Error('Neteisingas AI atsakymas.');
        }
      } catch (error) {
        console.error(error);
        appendMessage('assistant', 'Klaida bendraujant su Hexacola. Bandykite dar kartą.');
      }
    }

    // Function to append messages to the chat
    function appendMessage(role, content) {
      const chat = document.getElementById('chat');
      const messageDiv = document.createElement('div');
      messageDiv.classList.add('chat-message', role);
      messageDiv.textContent = content;
      chat.appendChild(messageDiv);
      chat.scrollTop = chat.scrollHeight;
    }
  </script>
</body>
</html>
